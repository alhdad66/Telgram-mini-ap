<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="app_title">Premium Ad Reward System</title>
    
    <!-- Adsgram SDK -->
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            /* Changed primary and secondary colors to vibrant green shades */
            --primary: #00BF63; /* Vibrant Green */
            --primary-dark: #008C4A; /* Darker shade for shadows */
            --secondary: #32CD32; /* Lime Green, for a more vibrant accent */
            --secondary-dark: #28A745; /* Darker shade of secondary */
            
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --card-bg: #1f1f1f;
            --gold: #ffd700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), #1a1a2e);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(0, 191, 99, 0.1) 0%, transparent 20%), /* Adjusted for green */
                radial-gradient(circle at 90% 80%, rgba(50, 205, 50, 0.1) 0%, transparent 20%); /* Adjusted for green */
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .header {
            /* Header gradient adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0) 50%,
                rgba(255,255,255,0.1) 100%);
            z-index: 1;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .content {
            padding: 25px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .user-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px 10px;
            width: 45%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #aaa;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary); 
        }
        
        .progress-container {
            margin: 25px 0;
            text-align: center;
        }
        
        .progress-label {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            /* Progress bar fill adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            border-radius: 10px;
            width: 30%;
            transition: width 0.5s ease;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        /* 3D Button Styles - Adjusted for green */
        .btn-3d {
            position: relative;
            padding: 16px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            text-align: center;
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            perspective: 500px;
            /* Box shadow uses primary-dark for depth */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Gradient background for button surface */
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .btn-3d::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            /* Shiny effect on hover */
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .btn-3d:hover {
            transform: translateY(4px);
            /* Adjust shadow on hover */
            box-shadow: 
                0 4px 0 var(--primary-dark),
                0 8px 10px rgba(0, 0, 0, 0.3);
        }
        
        .btn-3d:hover::after {
            left: 100%;
        }
        
        .btn-3d:active {
            transform: translateY(8px);
            /* Flatten shadow on click */
            box-shadow: 
                0 0 0 var(--primary-dark),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            /* Secondary button uses secondary-dark for shadow */
            box-shadow: 
                0 8px 0 var(--secondary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary::before {
            /* Secondary button background gradient */
            background: linear-gradient(45deg, var(--secondary), var(--primary-dark)); 
        }
        
        .btn-blue { /* This class is now essentially the same as btn-3d due to shared primary/secondary colors */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-blue::before {
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
        }
        
        .website-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .website-section h3 {
            color: var(--secondary); 
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #777;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .firebase-logo {
            display: inline-block;
            margin-top: 10px;
            font-size: 10px;
            background: rgba(255, 152, 0, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            color: #ffa726;
        }
        
        .ad-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .ad-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        /* Animation for ad watching */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        .ad-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px;
            }
        }
        
        /* Language Selector Styles - Active button gradient adjusted for green */
        .language-selector {
            position: absolute;
            top: 15px; 
            right: 15px; 
            display: flex;
            gap: 5px;
            z-index: 999; 
            background-color: rgba(0, 0, 0, 0.3); 
            border-radius: 10px; 
            padding: 5px; 
            backdrop-filter: blur(5px); 
        }
        .language-selector button {
            width: auto;
            padding: 5px 10px;
            font-size: 13px;
            background-color: rgba(255, 255, 255, 0.1); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; 
            cursor: pointer;
            min-width: 30px;
            transition: all 0.2s ease; 
        }
        .language-selector button.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
            border-color: var(--primary); 
        }
        .language-selector button:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.2); 
        }

        /* Withdrawal Section Styles - Button gradient adjusted for green */
        .withdraw-section {
            margin-top: 20px;
            display: none;
            padding: 25px; 
            background-color: rgba(255, 255, 255, 0.05); 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .withdraw-section h3 {
            color: var(--secondary); 
            margin-bottom: 5px; 
            font-size: 20px;
            font-weight: 600;
        }
        .withdraw-section .warning-message { 
            font-size: 13px;
            color: #FFC107; 
            margin-bottom: 15px;
            line-height: 1.4;
            white-space: pre-wrap; 
        }
        .withdraw-section input, 
        .withdraw-section select { 
            width: 100%;
            padding: 12px;
            margin: 10px 0; 
            border-radius: 10px; 
            /* Input border adjusted for green */
            border: 1px solid var(--primary); 
            background-color: var(--dark); 
            color: var(--light);
            font-size: 14px;
        }
        .withdraw-section input::placeholder {
            color: #aaa;
        }
        .withdraw-section input:focus, 
        .withdraw-section select:focus {
            border-color: var(--gold); 
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }
        .withdraw-section button {
            /* Withdrawal button gradient adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            width: 100%;
            padding: 14px; 
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px; 
            border-radius: 15px; 
            cursor: pointer;
            color: white; 
            border: none; 
            box-shadow: 0 8px 0 var(--primary-dark), 0 15px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .withdraw-section button:hover {
            transform: translateY(4px);
            box-shadow: 0 4px 0 var(--primary-dark), 0 8px 10px rgba(0, 0, 0, 0.3);
            /* Hover gradient adjusted for green */
            background: linear-gradient(90deg, var(--secondary), var(--primary)); 
        }
        .withdraw-section button:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 var(--primary-dark), 0 2px 5px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="ad-notification" id="ad-notification"></div>
    
    <div class="container">
        <!-- Language Selector -->
        <div class="language-selector">
            <button data-lang="ar" onclick="setLanguage('ar')">AR</button>
            <button data-lang="en" onclick="setLanguage('en')">EN</button>
            <button data-lang="ru" onclick="setLanguage('ru')">RU</button>
        </div>

        <div class="header">
            <h1 data-key="app_title">⛏️شغل المشاهده التلقائيه وادهب لي النوم 😴واستمتع بي الارباح🤫💵</h1>
        </div>
        
        <div class="content">
            <div class="user-info">
                <p data-key="earn_per_click_message">اربح 5 عملات pepe لكل نقرة🔥</p>
                <p data-key="min_withdrawal_message_static_general">السحب عن طريق FaucetPay من 10 عملات فقط ✅<br>السحب إلى أي محفظة أخرى من 100 عملة فقط ✅</p>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 data-key="watched_ads_label">الإعلانات المشاهدة</h3>
                    <div class="value" id="watched-ads">0</div>
                </div>
                <div class="stat-card">
                    <h3 data-key="earned_points_label">عملات Pepe المكتسبة</h3>
                    <div class="value" id="earned-points">0.00</div>
                </div>
            </div>
            
            <div class="stats"> 
                <div class="stat-card">
                    <h3 data-key="daily_limit_label">المشاهدات اليومية</h3>
                    <div class="value" id="daily-watched-ads">0 / 100</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span data-key="progress_to_bonus">التقدم للمكافأة</span>
                    <span id="ads-progress">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            
            <div class="ad-container">
                <div class="ad-label" data-key="ad_type_label">إعلان Adsgram بيني</div>
                <div class="buttons">
                    <button class="btn-3d" id="watch-ad-btn" onclick="watchAd()" data-key="watch_ad_btn_with_points">شاهد إعلان (+10.00 عملة pepe)</button>
                    <button class="btn-3d btn-secondary" id="auto-ad-btn" onclick="startAutoAds()" data-key="auto_show_ads_btn">عرض الإعلانات تلقائياً</button>
                    <button class="btn-3d" id="stop-auto-btn" onclick="stopAutoAds()" data-key="stop_auto_ads_btn">إيقاف العرض التلقائي</button>
                    <button class="btn-3d btn-blue" id="show-withdraw-btn" onclick="showWithdrawForm()" data-key="withdraw_points_btn">سحب عملات Pepe</button>
                </div>
            </div>
            
            <div class="website-section">
                <h3 data-key="visit_channel_title">قم بزيارة قناتنا على تيليجرام</h3>
                <button class="btn-3d btn-blue" onclick="window.open('https://t.me/dogsarn', '_blank')" data-key="visit_channel_button">زيارة القناة</button>
            </div>
        </div>
        
        <div class="footer">
            <p data-key="footer_text">مؤمن بواسطة Firebase • جميع المعاملات محمية</p>
            <div class="firebase-logo">Firebase</div>
        </div>

        <!-- Withdraw Section - Moved here to be hidden/shown -->
        <div class="withdraw-section" id="withdraw-section">
            <h3 data-key="withdrawal_request_title">طلب السحب</h3>
            <!-- Updated withdrawal warning message to include FaucetPay minimum -->
            <p class="warning-message" data-key="withdrawal_warning">تنبيه 🙋🏻‍♂️
الحد الأدنى للسحب عن طريق FaucetPay هو 10 عملات pepe.
الحد الأدنى للسحب إلى أي محفظة أخرى هو 100 عملة pepe.
يرجى التأكد من إدخال عنوان محفظة صحيح لتلقي السحب بدون مشاكل (◍•ᴗ•◍)</p>
            <input type="number" id="withdraw-amount" data-key-placeholder="enter_points_placeholder" placeholder="أدخل الكمية لسحب عملات Pepe" />
            <select id="payment-method"> 
                <option value="faucetpay" data-key="faucetpay_option">FaucetPay</option>
                <option value="other_wallet" data-key="other_wallet_option">السحب إلى أي محفظة أخرى</option>
            </select>
            <input type="text" id="wallet-address" data-key-placeholder="wallet_address_placeholder" placeholder="أدخل عنوان المحفظة" /> 
            <button onclick="withdrawPoints()" data-key="withdraw_button">سحب</button>
            <p id="withdraw-status"></p>
        </div>
    </div>

    <!-- Adsgram SDK -->
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <script>
        // Constants
        const POINTS_PER_AD = 10.00; // Reward per ad is now 10.00 Pepe Coins
        const ADS_FOR_BONUS = 10; 
        const MIN_WITHDRAW_POINTS = 100; // Minimum withdrawal for other wallets
        const MIN_WITHDRAW_POINTS_FAUCETPAY = 10; // Minimum withdrawal for FaucetPay
        const DAILY_AD_LIMIT = 100; // Daily limit for ads watched is now 100
        const ADMIN_USER_ID = "-1002705355317"; 
        const BOT_TOKEN = "7509054222:AAFhFhVXFCOs4kXtHQBigGU2QeNamHX42LQ"; 
        
        // State variables
        let watchedAdsCount = 0;
        let earnedPoints = 0.00; 
        let dailyWatchedAdsCount = 0; 
        let lastWatchDate = ""; 
        let autoAdInterval;
        let userId = null; 
        const telegramUserName = "💲💲"; 

        // DOM Elements
        const watchedAdsEl = document.getElementById('watched-ads');
        const earnedPointsEl = document.getElementById('earned-points');
        const dailyWatchedAdsEl = document.getElementById('daily-watched-ads'); 
        const adsProgressEl = document.getElementById('ads-progress');
        const progressFillEl = document.getElementById('progress-fill');
        const adNotificationEl = document.getElementById('ad-notification');
        const withdrawSectionEl = document.getElementById('withdraw-section');
        const withdrawStatusEl = document.getElementById('withdraw-status');
        const watchAdBtn = document.getElementById('watch-ad-btn');
        const autoAdBtn = document.getElementById('auto-ad-btn');
        const stopAutoBtn = document.getElementById('stop-auto-btn');
        
        // --- Translation Logic ---
        const translations = {
            ar: {
                app_title: "⛏️شغل المشاهده التلقائيه وادهب لي النوم 😴واستمتع بي الارباح🤫💵",
                earn_per_click_message: "اربح 5 عملات pepe لكل نقرة🔥", 
                // New static message for combined withdrawal limits
                min_withdrawal_message_static_general: `السحب عن طريق FaucetPay من ${MIN_WITHDRAW_POINTS_FAUCETPAY} عملات فقط ✅\nالسحب إلى أي محفظة أخرى من ${MIN_WITHDRAW_POINTS} عملة فقط ✅`, 
                watched_ads_label: "الإعلانات المشاهدة",
                earned_points_label: "عملات Pepe المكتسبة", 
                daily_limit_label: "المشاهدات اليومية", 
                progress_to_bonus: "التقدم للمكافأة",
                ad_type_label: "إعلان Adsgram بيني",
                watch_ad_btn_with_points: `شاهد إعلان (+${POINTS_PER_AD.toFixed(2)} عملة pepe)`, 
                auto_show_ads_btn: "عرض الإعلانات تلقائياً",
                stop_auto_ads_btn: "إيقاف العرض التلقائي",
                withdraw_points_btn: "سحب عملات Pepe", 
                visit_channel_title: "قم بزيارة قناتنا على تيليجرام", 
                visit_channel_button: "زيارة القناة", 
                footer_text: "مؤمن بواسطة Firebase • جميع المعاملات محمية",
                withdrawal_request_title: "طلب السحب",
                // Updated withdrawal warning message to include FaucetPay minimum
                withdrawal_warning: `تنبيه 🙋🏻‍♂️\nالحد الأدنى للسحب عن طريق FaucetPay هو ${MIN_WITHDRAW_POINTS_FAUCETPAY} عملات pepe.\nالحد الأدنى للسحب إلى أي محفظة أخرى هو ${MIN_WITHDRAW_POINTS} عملة pepe.\nيرجى التأكد من إدخال عنوان محفظة صحيح لتلقي السحب بدون مشاكل (◍•ᴗ•◍)`, 
                enter_points_placeholder: "أدخل الكمية لسحب عملات Pepe", 
                faucetpay_option: "FaucetPay",
                other_wallet_option: "السحب إلى أي محفظة أخرى",
                wallet_address_placeholder: "أدخل عنوان المحفظة",
                withdraw_button: "سحب",
                ad_loading: "جاري تحميل الإعلان... يرجى الانتظار",
                ad_completed_success: `اكتمل الإعلان! تمت إضافة ${POINTS_PER_AD.toFixed(2)} عملة pepe إلى حسابك`, 
                ad_failed: "فشل عرض الإعلان. يرجى المحاولة مرة أخرى.",
                auto_ads_started_notification: "بدأ العرض التلقائي للإعلانات. ستعمل الإعلانات كل 30 ثانية.",
                auto_ads_stopped_notification: "تم إيقاف العرض التلقائي للإعلانات.",
                daily_limit_reached: `لقد وصلت للحد الأقصى من المشاهدات اليومية (${DAILY_AD_LIMIT}). يرجى المحاولة غدًا.`, 
                // Updated min_withdraw_message to be dynamic based on method
                min_withdraw_message: `الحد الأدنى للسحب عن طريق {methodName} هو {minAmount} عملة pepe.`, 
                insufficient_balance: `رصيدك غير كافٍ. لديك {earnedPoints} عملة pepe.`, 
                enter_wallet_address: "يرجى إدخال عنوان المحفظة.",
                withdrawal_success_message: 'تم إرسال طلب السحب بنجاح!',
                telegram_send_fail: `فشل إرسال الطلب: {error}`,
                telegram_connect_error: `خطأ في الاتصال بخدمة تيليجرام: {error}`,
                unknown_method: "طريقة غير معروفة:",
            },
            en: {
                app_title: "⛏️Enable Auto Watch, Go to Sleep 😴, and Enjoy the Profits🤫💵", 
                earn_per_click_message: "Earn 5 Pepe coins per click🔥", 
                // New static message for combined withdrawal limits
                min_withdrawal_message_static_general: `Withdrawal via FaucetPay from ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins only ✅\nWithdrawal to Any Other Wallet from ${MIN_WITHDRAW_POINTS} pepe coins only ✅`, 
                watched_ads_label: "Watched Ads",
                earned_points_label: "Earned Pepe Coins", 
                daily_limit_label: "Daily Views", 
                progress_to_bonus: "Progress to Bonus",
                ad_type_label: "Adsgram Interstitial Ad",
                watch_ad_btn_with_points: `Watch Ad (+${POINTS_PER_AD.toFixed(2)} Pepe Coins)`, 
                auto_show_ads_btn: "Auto Show Ads",
                stop_auto_ads_btn: "Stop Auto Ads",
                withdraw_points_btn: "Withdraw Pepe Coins", 
                visit_channel_title: "Visit Our Telegram Channel", 
                visit_channel_button: "Visit Channel", 
                footer_text: "Secured by Firebase • All transactions are protected",
                withdrawal_request_title: "Withdrawal Request",
                // Updated withdrawal warning message to include FaucetPay minimum
                withdrawal_warning: `Warning 🙋🏻‍♂️\nMinimum withdrawal for FaucetPay is ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins.\nMinimum withdrawal for Any Other Wallet is ${MIN_WITHDRAW_POINTS} pepe coins.\nPlease ensure you enter a correct wallet address for smooth withdrawals (◍•ᴗ•◍)`, 
                enter_points_placeholder: "Enter Amount to Withdraw Pepe Coins", 
                faucetpay_option: "FaucetPay",
                other_wallet_option: "Withdraw to Any Other Wallet",
                wallet_address_placeholder: "Enter Wallet Address",
                withdraw_button: "Withdraw",
                ad_loading: "Loading ad... Please wait",
                ad_completed_success: `Ad completed! +${POINTS_PER_AD.toFixed(2)} Pepe Coins added to your account`, 
                ad_failed: "Failed to show ad. Please try again.",
                auto_ads_started_notification: "Auto ads started. Ads will play every 30 seconds.",
                auto_ads_stopped_notification: "Auto ads stopped.",
                daily_limit_reached: `You have reached the daily ad limit (${DAILY_AD_LIMIT}). Please try again tomorrow.`, 
                // Updated min_withdraw_message to be dynamic based on method
                min_withdraw_message: `Minimum withdrawal for {methodName} is {minAmount} pepe coins.`, 
                insufficient_balance: `Insufficient balance. You have {earnedPoints} Pepe Coins.`, 
                enter_wallet_address: "Please enter the wallet address.",
                withdrawal_success_message: 'Withdrawal request sent successfully!',
                telegram_send_fail: `Failed to send request: {error}`,
                telegram_connect_error: `Error connecting to Telegram service: {error}`,
                unknown_method: "Unknown method:",
            },
            ru: {
                app_title: "⛏️Включи автопросмотр и иди спать 😴, наслаждайся прибылью🤫💵", 
                earn_per_click_message: "Заработайте 5 монет Pepe за клик🔥", 
                // New static message for combined withdrawal limits
                min_withdrawal_message_static_general: `Вывод через FaucetPay от ${MIN_WITHDRAW_POINTS_FAUCETPAY} монет pepe только ✅\nВывод на любой другой кошелек от ${MIN_WITHDRAW_POINTS} монет pepe только ✅`, 
                watched_ads_label: "Просмотрено объявлений",
                earned_points_label: "Заработанные монеты Pepe", 
                daily_limit_label: "Ежедневные просмотры", 
                progress_to_bonus: "Прогресс к бонусу",
                ad_type_label: "Межстраничная реклама Adsgram",
                watch_ad_btn_with_points: `Смотреть рекламу (+${POINTS_PER_AD.toFixed(2)} монет Pepe)`, 
                auto_show_ads_btn: "Автоматический показ рекламы",
                stop_auto_ads_btn: "Остановить автопоказ",
                withdraw_points_btn: "Вывести монеты Pepe", 
                visit_channel_title: "Посетите наш Telegram-канал", 
                visit_channel_button: "Посетить канал", 
                footer_text: "Защищено Firebase • Все транзакции защищены",
                withdrawal_request_title: "Запрос на вывод",
                // Updated withdrawal warning message to include FaucetPay minimum
                withdrawal_warning: `Внимание 🙋🏻‍♂️\nМинимальная сумма вывода для FaucetPay составляет ${MIN_WITHDRAW_POINTS_FAUCETPAY} монет pepe.\nМинимальная сумма вывода для любого другого кошелька составляет ${MIN_WITHDRAW_POINTS} монет pepe.\nПожалуйста, убедитесь, что вы ввели правильный адрес кошелька для беспроблемного вывода средств (◍•ᴗ•◍)`, 
                enter_points_placeholder: "Введите сумму для вывода монет Pepe", 
                faucetpay_option: "FaucetPay",
                other_wallet_option: "Вывод на любой другой кошелек",
                wallet_address_placeholder: "Введите адрес кошелька",
                withdraw_button: "Вывести",
                ad_loading: "Загрузка рекламы... Пожалуйста, подождите",
                ad_completed_success: `Реклама завершена! +${POINTS_PER_AD.toFixed(2)} монет Pepe добавлено на ваш счет`, 
                ad_failed: "Не удалось показать рекламу. Пожалуйста, попробуйте еще раз.",
                auto_ads_started_notification: "Автоматический показ рекламы запущен. Реклама будет воспроизводиться каждые 30 секунд.",
                auto_ads_stopped_notification: "Остановить автопоказ.",
                daily_limit_reached: `Вы достигли дневного лимита по рекламе (${DAILY_AD_LIMIT}). Пожалуйста, попробуйте завтра.`, 
                // Updated min_withdraw_message to be dynamic based on method
                min_withdraw_message: `Минимальная сумма вывода для {methodName} составляет {minAmount} монет pepe.`, 
                insufficient_balance: `Недостаточный баланс. У вас {earnedPoints} монет pepe.`, 
                enter_wallet_address: "Пожалуйста, введите адрес кошелька.",
                withdrawal_success_message: 'Запрос на вывод успешно отправлен!',
                telegram_send_fail: `Не удалось отправить запрос: {error}`,
                telegram_connect_error: `Ошибка подключения к службе Telegram: {error}`,
                unknown_method: "Неизвестный метод:",
            }
        };

        let currentLanguage = localStorage.getItem('appLanguage') || 'ar'; // Default to Arabic

        // Function to get today's date inYYYY-MM-DD format
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Function to set the language
        window.setLanguage = function(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            document.documentElement.lang = lang; // Set HTML lang attribute

            // Update active button style
            document.querySelectorAll('.language-selector button').forEach(button => {
                if (button.dataset.lang === lang) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });

            // Translate all elements with data-key
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.dataset.key;
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('data-key-placeholder')) {
                        element.placeholder = translations[lang][key];
                    } else if (key === 'watch_ad_btn_with_points' || key === 'ad_completed_success') {
                         element.textContent = translations[lang][key];
                    } else if (key === 'daily_limit_reached') { 
                        element.textContent = translations[lang][key].replace(`(${DAILY_AD_LIMIT})`, `(${DAILY_AD_LIMIT})`); 
                    } else if (key === 'insufficient_balance') {
                        element.textContent = translations[lang][key].replace('{earnedPoints}', earnedPoints.toFixed(2));
                    } else if (key === 'min_withdrawal_message') { // Handle dynamic min_withdrawal_message
                        // This specific translation is handled inside withdrawPoints to be dynamic
                        // So we don't set it directly here
                    }
                    else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Translate all elements with data-key-placeholder
            document.querySelectorAll('[data-key-placeholder]').forEach(element => {
                const placeholderKey = element.dataset.keyPlaceholder;
                if (translations[lang] && translations[lang][placeholderKey]) {
                    element.placeholder = translations[lang][placeholderKey];
                }
            });

            // Translate options in select dropdowns
            document.querySelectorAll('#payment-method option').forEach(option => {
                const key = option.dataset.key;
                if (translations[lang] && translations[lang][key]) {
                    option.textContent = translations[lang][key];
                }
            });

            // Re-render dynamic content (like numbers)
            watchedAdsEl.textContent = watchedAdsCount; 
            earnedPointsEl.textContent = earnedPoints.toFixed(2); 
            dailyWatchedAdsEl.textContent = `${dailyWatchedAdsCount} / ${DAILY_AD_LIMIT}`; 
            adsProgressEl.textContent = `${Math.round((watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100)}%`; 
            showAdNotification(''); 
            withdrawStatusEl.textContent = ''; 
        };


        // Initialize the app
        function initApp() {
            // Load user data
            if (localStorage.getItem('watchedAdsCount')) {
                watchedAdsCount = parseInt(localStorage.getItem('watchedAdsCount'));
                earnedPoints = parseFloat(localStorage.getItem('earnedPoints'));
            }
            
            // Load daily ad watch data
            const todayDate = getTodayDate();
            if (localStorage.getItem('lastWatchDate') === todayDate) {
                dailyWatchedAdsCount = parseInt(localStorage.getItem('dailyWatchedAdsCount')) || 0;
            } else {
                // Reset daily count if it's a new day
                dailyWatchedAdsCount = 0;
                localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount);
            }
            localStorage.setItem('lastWatchDate', todayDate); // Always update last watch date

            // userId is no longer used for display.
            if (!localStorage.getItem('userId')) {
                const newUserId = 'USR-' + Math.floor(10000 + Math.random() * 90000);
                localStorage.setItem('userId', newUserId);
            }
            
            // Check if Adsgram SDK is loaded
            if (typeof window.Adsgram === 'undefined' || typeof window.Adsgram.init !== 'function') {
                console.error("Adsgram SDK is NOT loaded. Ad functionality may not work.");
                showAdNotification(translations[currentLanguage].ad_failed); // Notify user about SDK load issue
            } else {
                console.log("Adsgram SDK is loaded successfully.");
            }

            // Apply language on load and update UI
            setLanguage(currentLanguage);
            updateUI();
            updateButtonStates(); // Set initial button states based on daily limit
        }
        
        // Update UI elements
        function updateUI() {
            watchedAdsEl.textContent = watchedAdsCount;
            earnedPointsEl.textContent = earnedPoints.toFixed(2);
            dailyWatchedAdsEl.textContent = `${dailyWatchedAdsCount} / ${DAILY_AD_LIMIT}`; 
            
            const progress = (watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100;
            adsProgressEl.textContent = `${Math.round(progress)}%`;
            progressFillEl.style.width = `${progress}%`;
            
            // Add animation when points change
            earnedPointsEl.classList.remove('pulse');
            void earnedPointsEl.offsetWidth; // Trigger reflow
            earnedPointsEl.classList.add('pulse');

            updateButtonStates(); // Ensure button states are updated after UI changes
        }

        // Function to update button enabled/disabled states
        function updateButtonStates() {
            const limitReached = dailyWatchedAdsCount >= DAILY_AD_LIMIT;
            watchAdBtn.disabled = limitReached;
            autoAdBtn.disabled = limitReached; 
            
            if (limitReached) {
                // If limit reached, make sure auto ads are stopped
                clearInterval(autoAdInterval);
                autoAdInterval = null; // Clear the interval ID
                stopAutoBtn.disabled = true; 
            } else {
                stopAutoBtn.disabled = !autoAdInterval; 
            }
        }
        
        // Watch ad function using Adsgram
        async function watchAd() {
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) {
                showAdNotification(translations[currentLanguage].daily_limit_reached);
                return; 
            }

            showAdNotification(translations[currentLanguage].ad_loading);
            
            try {
                // Log before attempting to show ad
                console.log("Attempting to show Adsgram ad...");
                if (typeof window.Adsgram !== 'undefined' && typeof window.Adsgram.init === 'function') {
                    await window.Adsgram.init({ blockId: "12082" }).show(); 
                    console.log("Adsgram ad shown successfully."); // Log success
                    
                    watchedAdsCount++;
                    earnedPoints += POINTS_PER_AD; 
                    dailyWatchedAdsCount++; 

                    // Update last watched date to today
                    localStorage.setItem('lastWatchDate', getTodayDate());
                    localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount);
                    
                    if (watchedAdsCount % ADS_FOR_BONUS === 0) {
                        earnedPoints += 1.00; // Bonus point
                    }
                    
                    localStorage.setItem('watchedAdsCount', watchedAdsCount);
                    localStorage.setItem('earnedPoints', earnedPoints);
                    
                    updateUI(); 
                    
                    showAdNotification(translations[currentLanguage].ad_completed_success);
                } else {
                    // This else block indicates SDK not loaded, which is now checked in initApp too
                    console.error("Adsgram SDK is not available when trying to show ad.");
                    showAdNotification(translations[currentLanguage].ad_failed); 
                }

            } catch (error) {
                // Log specific error from Adsgram or network
                console.error("Adsgram ad failed to show or an error occurred:", error);
                showAdNotification(translations[currentLanguage].ad_failed);
            }
        }
        
        // Auto show ads 
        function startAutoAds() {
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) {
                showAdNotification(translations[currentLanguage].daily_limit_reached);
                return;
            }
            // Ensure any existing interval is cleared before starting a new one
            if (autoAdInterval) {
                clearInterval(autoAdInterval);
            }
            autoAdInterval = setInterval(watchAd, 30000); 
            autoAdBtn.disabled = true; 
            stopAutoBtn.disabled = false; 
            showAdNotification(translations[currentLanguage].auto_ads_started_notification);
        }
        
        function stopAutoAds() {
            clearInterval(autoAdInterval);
            autoAdInterval = null; 
            autoAdBtn.disabled = false; 
            stopAutoBtn.disabled = true; 
            showAdNotification(translations[currentLanguage].auto_ads_stopped_notification);
        }
        
        // Show ad notification
        function showAdNotification(message) {
            adNotificationEl.textContent = message;
            adNotificationEl.style.display = 'block';
            
            setTimeout(() => {
                adNotificationEl.style.display = 'none';
            }, 3000);
        }

        // Function to show withdraw form
        function showWithdrawForm() {
            withdrawSectionEl.style.display = 'block';
        }

        // Function to handle withdrawal
        function withdrawPoints() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const paymentMethod = document.getElementById('payment-method').value; 
            const walletAddress = document.getElementById('wallet-address').value; 

            let minRequiredPoints;
            let methodName;

            if (paymentMethod === 'faucetpay') {
                minRequiredPoints = MIN_WITHDRAW_POINTS_FAUCETPAY;
                methodName = translations[currentLanguage].faucetpay_option;
            } else { // Covers 'other_wallet' and any default case
                minRequiredPoints = MIN_WITHDRAW_POINTS;
                methodName = translations[currentLanguage].other_wallet_option;
            }

            if (isNaN(amount) || amount < minRequiredPoints) {
                // Use dynamic message for minimum withdrawal
                let message = translations[currentLanguage].min_withdraw_message
                    .replace('{methodName}', methodName)
                    .replace('{minAmount}', minRequiredPoints);
                showTemporaryMessage(message, 'red');
                return;
            }

            if (amount > earnedPoints) {
                let message = translations[currentLanguage].insufficient_balance.replace('{earnedPoints}', earnedPoints.toFixed(2));
                showTemporaryMessage(message, 'red');
                return;
            }

            if (!walletAddress.trim()) { 
                showTemporaryMessage(translations[currentLanguage].enter_wallet_address, 'red');
                return;
            }

            earnedPoints -= amount;
            localStorage.setItem('earnedPoints', earnedPoints.toFixed(2)); 
            updateUI(); 

            // Construct Telegram message based on selected payment method
            let messageToAdmin = `New Withdrawal Request:\nUser: ${telegramUserName}\nAmount: ${amount} pepe coins\nPayment Method: `;
            if (paymentMethod === 'faucetpay') {
                messageToAdmin += `FaucetPay\nWallet Address: ${walletAddress}`;
            } else if (paymentMethod === 'other_wallet') {
                messageToAdmin += `Other Wallet\nWallet Address: ${walletAddress}`;
            } else {
                messageToAdmin += `Unknown Method: ${paymentMethod}\nWallet Address: ${walletAddress}`; 
            }
            
            sendWithdrawRequestToAdmin(messageToAdmin);

            showTemporaryMessage(translations[currentLanguage].withdrawal_success_message, 'green');

            document.getElementById('withdraw-amount').value = '';
            document.getElementById('wallet-address').value = '';
        }

        // Function to send withdrawal request to admin via Telegram
        function sendWithdrawRequestToAdmin(message) {
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_USER_ID}&text=${encodeURIComponent(message)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        console.log('Message sent to admin');
                    } else {
                        console.error('Failed to send message to Telegram:', data.description || data);
                        let errorMessage = translations[currentLanguage].telegram_send_fail.replace('{error}', data.description || data);
                        showTemporaryMessage(errorMessage, 'red');
                    }
                })
                .catch(error => {
                    console.error('Error during fetch to Telegram API:', error);
                    let errorMessage = translations[currentLanguage].telegram_connect_error.replace('{error}', error.message);
                    showTemporaryMessage(errorMessage, 'red');
                });
        }

        // Utility for showing temporary messages
        let messageTimeout;
        function showTemporaryMessage(msg, color) {
            withdrawStatusEl.textContent = msg;
            withdrawStatusEl.style.color = color;
            clearTimeout(messageTimeout);
            messageTimeout = setTimeout(() => {
                withdrawStatusEl.textContent = '';
            }, 5000); 
        }

        // Initialize app on load
        window.onload = initApp;
    </script>
</body>
</html>
