<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="app_title">Premium Ad Reward System</title>
    
    <!-- Adsgram SDK -->
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <!-- Telegram Web Apps SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            /* Changed primary and secondary colors to vibrant green shades */
            --primary: #00BF63; /* Vibrant Green */
            --primary-dark: #008C4A; /* Darker shade for shadows */
            --secondary: #32CD32; /* Lime Green, for a more vibrant accent */
            --secondary-dark: #28A745; /* Darker shade of secondary */
            
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --card-bg: #1f1f1f;
            --gold: #ffd700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), #1a1a2e);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
            /* Telegram Mini App specific: use Telegram's background color */
            background-color: var(--tg-theme-bg-color, #1a1a2e); 
            transition: background-color 0.3s ease;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(0, 191, 99, 0.1) 0%, transparent 20%), /* Adjusted for green */
                radial-gradient(circle at 90% 80%, rgba(50, 205, 50, 0.1) 0%, transparent 20%); /* Adjusted for green */
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
            /* Telegram Mini App specific: use Telegram's secondary background color for card */
            background-color: var(--tg-theme-secondary-bg-color, #1f1f1f);
            transition: background-color 0.3s ease;
        }
        
        .header {
            /* Header gradient adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0) 50%,
                rgba(255,255,255,0.1) 100%);
            z-index: 1;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .content {
            padding: 25px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .user-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        /* Updated .stats to center the single card */
        .stats {
            display: flex;
            justify-content: center; /* Center the single card */
            margin: 20px 0;
            text-align: center;
        }
        
        /* Enlarged stat-card for earned points */
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px 30px; /* Increased padding */
            width: 80%; /* Made it wider */
            max-width: 300px; /* Max width to keep it reasonable */
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            margin-bottom: 20px; /* Space between points card and ad container */
        }
        
        .stat-card h3 {
            font-size: 18px; /* Larger font for title */
            margin-bottom: 10px; /* More space */
            color: #aaa;
        }
        
        .stat-card .value {
            font-size: 36px; /* Significantly larger font for value */
            font-weight: 700;
            color: var(--primary); 
        }
        
        .progress-container {
            margin: 25px 0;
            text-align: center;
        }
        
        .progress-label {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            /* Progress bar fill adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            border-radius: 10px;
            width: 30%;
            transition: width 0.5s ease;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        /* 3D Button Styles - Adjusted for green */
        .btn-3d {
            position: relative;
            padding: 16px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            text-align: center;
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            perspective: 500px;
            /* Box shadow uses primary-dark for depth */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Gradient background for button surface */
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .btn-3d::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            /* Shiny effect on hover */
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .btn-3d:hover {
            transform: translateY(4px);
            /* Adjust shadow on hover */
            box-shadow: 
                0 4px 0 var(--primary-dark),
                0 8px 10px rgba(0, 0, 0, 0.3);
        }
        
        .btn-3d:hover::after {
            left: 100%;
        }
        
        .btn-3d:active {
            transform: translateY(8px);
            /* Flatten shadow on click */
            box-shadow: 
                0 0 0 var(--primary-dark),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            /* Secondary button uses secondary-dark for shadow */
            box-shadow: 
                0 8px 0 var(--secondary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary::before {
            /* Secondary button background gradient */
            background: linear-gradient(45deg, var(--secondary), var(--primary-dark)); 
        }
        
        .btn-blue { /* This class is now essentially the same as btn-3d due to shared primary/secondary colors */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-blue::before {
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
        }
        
        .website-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .website-section h3 {
            color: var(--secondary); 
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #777;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .firebase-logo {
            display: inline-block;
            margin-top: 10px;
            font-size: 10px;
            background: rgba(255, 152, 0, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            color: #ffa726;
        }
        
        .ad-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .ad-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        /* Animation for ad watching */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        .ad-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px;
            }
            .tap-area {
                width: 180px; /* Adjust size for smaller screens */
                height: 180px;
            }
            .tap-area img {
                width: 100%; /* Make image fill for smaller screens */
                height: 100%;
            }
            .tap-area h2 {
                font-size: 36px;
            }
            .tap-area p {
                font-size: 16px;
            }
            .stat-card { /* Adjust for smaller screens */
                width: 95%;
                padding: 15px 20px;
            }
            .stat-card h3 {
                font-size: 16px;
            }
            .stat-card .value {
                font-size: 30px;
            }
        }
        
        /* Language Selector Styles - Active button gradient adjusted for green */
        .language-selector {
            position: absolute;
            top: 15px; 
            right: 15px; 
            display: flex;
            gap: 5px;
            z-index: 999; 
            background-color: rgba(0, 0, 0, 0.3); 
            border-radius: 10px; 
            padding: 5px; 
            backdrop-filter: blur(5px); 
        }
        .language-selector button {
            width: auto;
            padding: 5px 10px;
            font-size: 13px;
            background-color: rgba(255, 255, 255, 0.1); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; 
            cursor: pointer;
            min-width: 30px;
            transition: all 0.2s ease; 
        }
        .language-selector button.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
            border-color: var(--primary); 
        }
        .language-selector button:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.2); 
        }

        /* Withdrawal Section Styles - Adapted to be integrated */
        .withdraw-section {
            margin-top: 20px;
            display: none; /* Hidden by default, shown by JS */
            padding: 25px; 
            background-color: rgba(255, 255, 255, 0.05); 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .withdraw-section h3 {
            color: var(--secondary); 
            margin-bottom: 5px; 
            font-size: 20px;
            font-weight: 600;
        }
        .withdraw-section .warning-message { 
            font-size: 13px;
            color: #FFC107; 
            margin-bottom: 15px;
            line-height: 1.4;
            white-space: pre-wrap; 
            background: rgba(255, 215, 0, 0.1); /* Light gold background for warning */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #FFD700;
        }
        .withdraw-section input, 
        .withdraw-section select { 
            width: 100%;
            padding: 12px;
            margin: 10px 0; 
            border-radius: 10px; 
            border: 1px solid var(--primary); 
            background-color: var(--dark); 
            color: var(--light);
            font-size: 14px;
        }
        .withdraw-section input::placeholder {
            color: #aaa;
        }
        .withdraw-section input:focus, 
        .withdraw-section select:focus {
            border-color: var(--gold); 
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }
        .withdraw-section button {
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            width: 100%;
            padding: 14px; 
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px; 
            border-radius: 15px; 
            cursor: pointer;
            color: white; 
            border: none; 
            box-shadow: 0 8px 0 var(--primary-dark), 0 15px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .withdraw-section button:hover {
            transform: translateY(4px);
            box-shadow: 0 4px 0 var(--primary-dark), 0 8px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, var(--secondary), var(--primary)); 
        }
        .withdraw-section button:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 var(--primary-dark), 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .withdraw-section p.current-balance {
            font-size: 18px;
            color: var(--gold);
            margin-bottom: 25px;
            font-weight: 600;
        }

        .back-button-container {
            margin-top: 25px;
            text-align: center;
        }
        .back-button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            padding: 10px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-size: 14px;
            transition: background-color 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: inline-block; /* Make it a block for centering */
        }
        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Hamster Kombat Style Tap Area */
        .tap-area {
            background: radial-gradient(circle at center, #2e2e2e 0%, #1a1a1a 100%);
            border-radius: 50%; /* Make it circular */
            margin: 20px auto; /* Center the circular area */
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            position: relative;
            width: 220px; /* Set fixed width and height for a perfect circle */
            height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.5); /* Added outer shadow */
            animation: backgroundPulse 5s infinite alternate;
            user-select: none; /* Prevent text selection on tap */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+ */
        }

        /* Image inside the tap area */
        .tap-area img {
            width: 100%; /* Make image fill the circle's width */
            height: 100%; /* Make image fill the circle's height */
            object-fit: cover; /* Make image cover the area, cropping if necessary */
            border-radius: 50%; /* Ensure image itself is circular */
            position: absolute; /* Position image absolutely within the tap-area */
            top: 0;
            left: 0;
            z-index: 5; /* Place image behind text but above background pulse */
            transition: transform 0.1s ease;
        }

        .tap-area.active img {
            transform: scale(0.95); /* Shrink image on tap */
        }

        @keyframes backgroundPulse {
            0% { background: radial-gradient(circle at center, #2e2e2e 0%, #1a1a1a 100%); }
            100% { background: radial-gradient(circle at center, #3a3a3a 0%, #2a2a2a 100%); }
        }

        .tap-area h2 {
            font-size: 48px;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 5px; /* Adjusted margin */
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
            transition: transform 0.1s ease;
            position: relative;
            z-index: 10; /* Ensure text is above image */
        }

        .tap-area p {
            font-size: 18px;
            color: #ccc;
            margin-top: 0; /* Adjusted margin */
            position: relative;
            z-index: 10; /* Ensure text is above image */
        }

        .tap-feedback {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: var(--gold);
            opacity: 0;
            pointer-events: none;
            animation: fadeOutUp 1s forwards;
            text-shadow: 0 0 5px rgba(255,215,0,0.8);
            z-index: 20;
        }

        @keyframes fadeOutUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .tap-button-container {
            margin-top: 20px;
            text-align: center;
        }

        .tap-claim-btn {
            display: none; /* Hidden by default */
            position: relative;
            padding: 16px 30px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            color: white;
            background: linear-gradient(90deg, #28a745, #218838); /* Green gradient */
            box-shadow: 
                0 8px 0 #1e7e34, 
                0 15px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            perspective: 500px;
            overflow: hidden;
            z-index: 1;
        }

        .tap-claim-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #28a745, #218838); 
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .tap-claim-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .tap-claim-btn:hover {
            transform: translateY(4px);
            box-shadow: 
                0 4px 0 #1e7e34,
                0 8px 10px rgba(0, 0, 0, 0.3);
        }
        
        .tap-claim-btn:hover::after {
            left: 100%;
        }
        
        .tap-claim-btn:active {
            transform: translateY(8px);
            box-shadow: 
                0 0 0 #1e7e34,
                0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .tap-claim-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 8px 0 #1e7e34, 
                        0 15px 20px rgba(0, 0, 0, 0.4);
        }

        .points-per-tap-message {
            font-size: 16px;
            color: var(--light);
            margin-top: 15px; /* Spacing below the circle/claim button */
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="ad-notification" id="ad-notification"></div>
    
    <div class="container">
        <!-- Language Selector -->
        <div class="language-selector">
            <button data-lang="ar" onclick="setLanguage('ar')">AR</button>
            <button data-lang="en" onclick="setLanguage('en')">EN</button>
            <button data-lang="ru" onclick="setLanguage('ru')">RU</button>
        </div>

        <div class="header">
            <h1 data-key="app_title">‚õèÔ∏èÿ¥ÿ∫ŸÑ ÿßŸÑŸÖÿ¥ÿßŸáÿØŸá ÿßŸÑÿ™ŸÑŸÇÿßÿ¶ŸäŸá ŸàÿßÿØŸáÿ® ŸÑŸä ÿßŸÑŸÜŸàŸÖ üò¥Ÿàÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®Ÿä ÿßŸÑÿßÿ±ÿ®ÿßÿ≠ü§´üíµ</h1>
        </div>
        
        <div class="content">
            <div class="user-info">
                <p data-key="earn_per_click_message">ÿßÿ±ÿ®ÿ≠ 5 ÿπŸÖŸÑÿßÿ™ pepe ŸÑŸÉŸÑ ŸÜŸÇÿ±ÿ©üî•</p>
                <p data-key="min_withdrawal_message_static_general">ÿßŸÑÿ≥ÿ≠ÿ® ÿπŸÜ ÿ∑ÿ±ŸäŸÇ FaucetPay ŸÖŸÜ 10 ÿπŸÖŸÑÿßÿ™ ŸÅŸÇÿ∑ ‚úÖ<br>ÿßŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ ŸÖŸÜ 100 ÿπŸÖŸÑÿ© ŸÅŸÇÿ∑ ‚úÖ</p>
            </div>
            
            <!-- Moved and Enlarged Earned Points Stat Card -->
            <div class="stats"> 
                <div class="stat-card">
                    <h3 data-key="earned_points_label">ÿπŸÖŸÑÿßÿ™ Pepe ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©</h3>
                    <div class="value" id="earned-points">0.00</div>
                </div>
            </div>
            
            <!-- Removed Watched Ads and Daily Limit Stats here -->
            
            <div class="progress-container">
                <div class="progress-label">
                    <span data-key="progress_to_bonus">ÿßŸÑÿ™ŸÇÿØŸÖ ŸÑŸÑŸÖŸÉÿßŸÅÿ£ÿ©</span>
                    <span id="ads-progress">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            
            <div class="ad-container">
                <div class="ad-label" data-key="ad_type_label">ÿ•ÿπŸÑÿßŸÜ Adsgram ÿ®ŸäŸÜŸä</div>
                
                <!-- New Tap Area -->
                <div class="tap-area" id="tap-area">
                    <img src="https://f.top4top.io/p_3464tveeu0.jpeg" alt="Pepe Coin Image" onerror="this.onerror=null; this.src='https://placehold.co/220x220/00BF63/FFFFFF?text=Pepe+Coin';">
                    <h2 id="taps-remaining">10</h2>
                    <p data-key="taps_to_claim">ŸÜŸÇÿ±ÿ© ŸÑŸÑŸÖÿ∑ÿßŸÑÿ®ÿ© ÿ®ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©</p>
                </div>

                <div class="tap-button-container">
                    <button class="btn-3d tap-claim-btn" id="claim-reward-btn" onclick="claimReward()" data-key="claim_reward_btn">ÿßŸÑŸÖÿ∑ÿßŸÑÿ®ÿ© ÿ®ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©</button>
                </div>
                
                <!-- New text below the tap area -->
                <p class="points-per-tap-message" data-key="points_per_tap_message">ÿßÿ±ÿ®ÿ≠ 1 Pepe ŸÑŸÉŸÑ ŸÜŸÇÿ±ÿ©</p>

            </div>
            
            <div class="website-section">
                <h3 data-key="visit_channel_title">ŸÇŸÖ ÿ®ÿ≤Ÿäÿßÿ±ÿ© ŸÇŸÜÿßÿ™ŸÜÿß ÿπŸÑŸâ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ</h3>
                <button class="btn-3d btn-blue" onclick="window.open('https://t.me/dogsarn', '_blank')" data-key="visit_channel_button">ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÇŸÜÿßÿ©</button>
            </div>

            <div class="buttons">
                <!-- Button to show the integrated withdrawal form -->
                <button class="btn-3d btn-blue" id="show-withdraw-btn" onclick="showWithdrawForm()" data-key="withdraw_points_btn">ÿ≥ÿ≠ÿ® ÿπŸÖŸÑÿßÿ™ Pepe</button>
            </div>

            <!-- Withdraw Section - Now integrated back into the main page -->
            <div class="withdraw-section" id="withdraw-section">
                <h3 data-key="withdrawal_request_title">ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®</h3>
                <p class="current-balance" data-key="current_balance_label">ÿ±ÿµŸäÿØŸÉ ÿßŸÑÿ≠ÿßŸÑŸä: <span id="current-earned-points">0.00</span> ÿπŸÖŸÑÿ© Pepe</p>
                <p class="warning-message" data-key="withdrawal_warning">ÿ™ŸÜÿ®ŸäŸá üôãüèª‚Äç‚ôÇÔ∏è
ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ÿπŸÜ ÿ∑ÿ±ŸäŸÇ FaucetPay ŸáŸà 10 ÿπŸÖŸÑÿßÿ™ pepe.
ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ ŸáŸà 100 ÿπŸÖŸÑÿ© pepe.
Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿØÿÆÿßŸÑ ÿπŸÜŸàÿßŸÜ ŸÖÿ≠ŸÅÿ∏ÿ© ÿµÿ≠Ÿäÿ≠ ŸÑÿ™ŸÑŸÇŸä ÿßŸÑÿ≥ÿ≠ÿ® ÿ®ÿØŸàŸÜ ŸÖÿ¥ÿßŸÉŸÑ (‚óç‚Ä¢·¥ó‚Ä¢‚óç)</p>
                <input type="number" id="withdraw-amount" data-key-placeholder="enter_points_placeholder" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸÖŸäÿ© ŸÑÿ≥ÿ≠ÿ® ÿπŸÖŸÑÿßÿ™ Pepe" />
                <select id="payment-method"> 
                    <option value="faucetpay" data-key="faucetpay_option">FaucetPay</option>
                    <option value="other_wallet" data-key="other_wallet_option">ÿßŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ</option>
                </select>
                <input type="text" id="wallet-address" data-key-placeholder="wallet_address_placeholder" placeholder="ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©" /> 
                <button onclick="withdrawPoints()" data-key="withdraw_button">ÿ≥ÿ≠ÿ®</button>
                <p id="withdraw-status"></p>

                <div class="back-button-container">
                    <!-- Button to hide the withdrawal form -->
                    <a href="#" class="back-button" onclick="hideWithdrawForm(); return false;" data-key="back_to_main_page">ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p data-key="footer_text">ŸÖÿ§ŸÖŸÜ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Firebase ‚Ä¢ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™ ŸÖÿ≠ŸÖŸäÿ©</p>
            <div class="firebase-logo">Firebase</div>
        </div>
    </div>

    <!-- Adsgram SDK (already present) -->
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <script>
        // Constants
        const POINTS_PER_AD = 1.00; // Reward per ad is now 1.00 Pepe Coins for 10 taps
        const TAPS_REQUIRED = 10; // Number of taps required to claim reward
        const ADS_FOR_BONUS = 10; 
        const MIN_WITHDRAW_POINTS = 100; // Minimum withdrawal for other wallets
        const MIN_WITHDRAW_POINTS_FAUCETPAY = 10; // Minimum withdrawal for FaucetPay
        const DAILY_AD_LIMIT = 100; // Daily limit for ads watched is now 100
        const ADMIN_USER_ID = "-1002705355317"; 
        const BOT_TOKEN = "7509054222:AAFhFhVXFCOs4kXtHQBigGU2QeNamHX42LQ"; 
        
        // State variables
        let watchedAdsCount = 0;
        let earnedPoints = 0.00; 
        let dailyWatchedAdsCount = 0; 
        let lastWatchDate = ""; 
        let tapsCount = 0; // New: Counter for taps
        let autoAdInterval; // Keep for potential future use or removal
        let userId = null; 
        let telegramUserName = "üí≤üí≤"; // Default username, will be updated by Telegram Web App init
        
        // Telegram Web App object
        const WebApp = window.Telegram && window.Telegram.WebApp;

        // DOM Elements
        const earnedPointsEl = document.getElementById('earned-points');
        const adsProgressEl = document.getElementById('ads-progress');
        const progressFillEl = document.getElementById('progress-fill');
        const adNotificationEl = document.getElementById('ad-notification');
        
        // Withdrawal Section DOM elements
        const withdrawSectionEl = document.getElementById('withdraw-section');
        const withdrawStatusEl = document.getElementById('withdraw-status');
        const currentEarnedPointsEl = document.getElementById('current-earned-points');

        const tapAreaEl = document.getElementById('tap-area'); // New: Tap area element
        const tapsRemainingEl = document.getElementById('taps-remaining'); // New: Taps remaining element
        const claimRewardBtn = document.getElementById('claim-reward-btn'); // New: Claim reward button
        const tapImageEl = tapAreaEl.querySelector('img'); // New: Image inside tap area
        
        // --- Translation Logic ---
        const translations = {
            ar: {
                app_title: "‚õèÔ∏èÿ¥ÿ∫ŸÑ ÿßŸÑŸÖÿ¥ÿßŸáÿØŸá ÿßŸÑÿ™ŸÑŸÇÿßÿ¶ŸäŸá ŸàÿßÿØŸáÿ® ŸÑŸä ÿßŸÑŸÜŸàŸÖ üò¥Ÿàÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®Ÿä ÿßŸÑÿßÿ±ÿ®ÿßÿ≠ü§´üíµ",
                earn_per_click_message: "ÿßÿ±ÿ®ÿ≠ 5 ÿπŸÖŸÑÿßÿ™ pepe ŸÑŸÉŸÑ ŸÜŸÇÿ±ÿ©üî•", 
                points_per_tap_message: "ÿßÿ±ÿ®ÿ≠ 1 Pepe ŸÑŸÉŸÑ ŸÜŸÇÿ±ÿ©", 
                min_withdrawal_message_static_general: `ÿßŸÑÿ≥ÿ≠ÿ® ÿπŸÜ ÿ∑ÿ±ŸäŸÇ FaucetPay ŸÖŸÜ ${MIN_WITHDRAW_POINTS_FAUCETPAY} ÿπŸÖŸÑÿßÿ™ ŸÅŸÇÿ∑ ‚úÖ\nÿßŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ ŸÖŸÜ ${MIN_WITHDRAW_POINTS} ÿπŸÖŸÑÿ© ŸÅŸÇÿ∑ ‚úÖ`, 
                watched_ads_label: "ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ¥ÿßŸáÿØÿ©", 
                earned_points_label: "ÿπŸÖŸÑÿßÿ™ Pepe ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©", 
                daily_limit_label: "ÿßŸÑŸÖÿ¥ÿßŸáÿØÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©", 
                progress_to_bonus: "ÿßŸÑÿ™ŸÇÿØŸÖ ŸÑŸÑŸÖŸÉÿßŸÅÿ£ÿ©",
                ad_type_label: "ÿ•ÿπŸÑÿßŸÜ Adsgram ÿ®ŸäŸÜŸä",
                taps_to_claim: "ŸÜŸÇÿ±ÿ© ŸÑŸÑŸÖÿ∑ÿßŸÑÿ®ÿ© ÿ®ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©", 
                claim_reward_btn: "ÿßŸÑŸÖÿ∑ÿßŸÑÿ®ÿ© ÿ®ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©", 
                visit_channel_title: "ŸÇŸÖ ÿ®ÿ≤Ÿäÿßÿ±ÿ© ŸÇŸÜÿßÿ™ŸÜÿß ÿπŸÑŸâ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ", 
                visit_channel_button: "ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÇŸÜÿßÿ©", 
                footer_text: "ŸÖÿ§ŸÖŸÜ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Firebase ‚Ä¢ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™ ŸÖÿ≠ŸÖŸäÿ©",
                withdrawal_request_title: "ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®", 
                current_balance_label: "ÿ±ÿµŸäÿØŸÉ ÿßŸÑÿ≠ÿßŸÑŸä:", 
                withdrawal_warning: `ÿ™ŸÜÿ®ŸäŸá üôãüèª‚Äç‚ôÇÔ∏è\nÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ÿπŸÜ ÿ∑ÿ±ŸäŸÇ FaucetPay ŸáŸà ${MIN_WITHDRAW_POINTS_FAUCETPAY} ÿπŸÖŸÑÿßÿ™ pepe.\nÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ ŸáŸà ${MIN_WITHDRAW_POINTS} ÿπŸÖŸÑÿ© pepe.\nŸäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿØÿÆÿßŸÑ ÿπŸÜŸàÿßŸÜ ŸÖÿ≠ŸÅÿ∏ÿ© ÿµÿ≠Ÿäÿ≠ ŸÑÿ™ŸÑŸÇŸä ÿßŸÑÿ≥ÿ≠ÿ® ÿ®ÿØŸàŸÜ ŸÖÿ¥ÿßŸÉŸÑ (‚óç‚Ä¢·¥ó‚Ä¢‚óç)`, 
                enter_points_placeholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸÖŸäÿ© ŸÑÿ≥ÿ≠ÿ® ÿπŸÖŸÑÿßÿ™ Pepe", 
                faucetpay_option: "FaucetPay", 
                other_wallet_option: "ÿßŸÑÿ≥ÿ≠ÿ® ÿ•ŸÑŸâ ÿ£Ÿä ŸÖÿ≠ŸÅÿ∏ÿ© ÿ£ÿÆÿ±Ÿâ", 
                wallet_address_placeholder: "ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©", 
                withdraw_button: "ÿ≥ÿ≠ÿ®", 
                ad_loading: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜ... Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±",
                ad_completed_success: `ÿßŸÉÿ™ŸÖŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜ! ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ${POINTS_PER_AD.toFixed(2)} ÿπŸÖŸÑÿ© pepe ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ®ŸÉ`, 
                ad_failed: "ŸÅÿ¥ŸÑ ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿπŸÑÿßŸÜ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
                daily_limit_reached: `ŸÑŸÇÿØ ŸàÿµŸÑÿ™ ŸÑŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÖŸÜ ÿßŸÑŸÖÿ¥ÿßŸáÿØÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ© (${DAILY_AD_LIMIT}). Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ÿ∫ÿØŸãÿß.`, 
                min_withdraw_message: `ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ÿπŸÜ ÿ∑ÿ±ŸäŸÇ {methodName} ŸáŸà {minAmount} ÿπŸÖŸÑÿ© pepe.`, 
                insufficient_balance: `ÿ±ÿµŸäÿØŸÉ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç. ŸÑÿØŸäŸÉ {earnedPoints} ÿπŸÖŸÑÿ© pepe.`, 
                enter_wallet_address: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©.", 
                withdrawal_success_message: 'ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® ÿ®ŸÜÿ¨ÿßÿ≠!', 
                telegram_send_fail: `ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®: {error}`, 
                telegram_connect_error: `ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿÆÿØŸÖÿ© ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ: {error}`, 
                unknown_method: "ÿ∑ÿ±ŸäŸÇÿ© ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅÿ©:", 
                back_to_main_page: "ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©", 
                withdraw_points_btn: "ÿ≥ÿ≠ÿ® ÿπŸÖŸÑÿßÿ™ Pepe", 
            },
            en: {
                app_title: "‚õèÔ∏èEnable Auto Watch, Go to Sleep üò¥, and Enjoy the Profitsü§´üíµ", 
                earn_per_click_message: "Earn 5 Pepe coins per clicküî•", 
                points_per_tap_message: "Earn 1 Pepe per tap",
                min_withdrawal_message_static_general: `Withdrawal via FaucetPay from ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins only ‚úÖ\nWithdrawal to Any Other Wallet from ${MIN_WITHDRAW_POINTS} pepe coins only ‚úÖ`, 
                watched_ads_label: "Watched Ads", 
                earned_points_label: "Earned Pepe Coins", 
                daily_limit_label: "Daily Views", 
                progress_to_bonus: "Progress to Bonus",
                ad_type_label: "Adsgram Interstitial Ad",
                taps_to_claim: "taps to claim reward",
                claim_reward_btn: "Claim Reward",
                visit_channel_title: "Visit Our Telegram Channel", 
                visit_channel_button: "Visit Channel", 
                footer_text: "Secured by Firebase ‚Ä¢ All transactions are protected",
                withdrawal_request_title: "Withdrawal Request", 
                current_balance_label: "Your Current Balance:", 
                withdrawal_warning: `Warning üôãüèª‚Äç‚ôÇÔ∏è\nMinimum withdrawal for FaucetPay is ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins.\nMinimum withdrawal for Any Other Wallet is ${MIN_WITHDRAW_POINTS} pepe coins.\nPlease ensure you enter a correct wallet address for smooth withdrawals (‚óç‚Ä¢·¥ó‚Ä¢‚óç)`, 
                enter_points_placeholder: "Enter Amount to Withdraw Pepe Coins", 
                faucetpay_option: "FaucetPay", 
                other_wallet_option: "Withdraw to Any Other Wallet", 
                wallet_address_placeholder: "Enter Wallet Address", 
                withdraw_button: "Withdraw", 
                ad_loading: "Loading ad... Please wait",
                ad_completed_success: `Ad completed! +${POINTS_PER_AD.toFixed(2)} Pepe Coins added to your account`, 
                ad_failed: "Failed to show ad. Please try again.",
                daily_limit_reached: `You have reached the daily ad limit (${DAILY_AD_LIMIT}). Please try again tomorrow.`, 
                min_withdraw_message: `Minimum withdrawal for {methodName} is {minAmount} pepe coins.`, 
                insufficient_balance: `Insufficient balance. You have {earnedPoints} Pepe Coins.`, 
                enter_wallet_address: "Please enter the wallet address.", 
                withdrawal_success_message: 'Withdrawal request sent successfully!', 
                telegram_send_fail: `Failed to send request: {error}`, 
                telegram_connect_error: `Error connecting to Telegram service: {error}`, 
                unknown_method: "Unknown Method:", 
                back_to_main_page: "Back to Main Page", 
                withdraw_points_btn: "Withdraw Pepe Coins", 
            },
            ru: {
                app_title: "‚õèÔ∏è–í–∫–ª—é—á–∏ –∞–≤—Ç–æ–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –∏–¥–∏ —Å–ø–∞—Ç—å üò¥, –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è –ø—Ä–∏–±—ã–ª—å—éü§´üíµ", 
                earn_per_click_message: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 5 –º–æ–Ω–µ—Ç Pepe –∑–∞ –∫–ª–∏–∫üî•", 
                points_per_tap_message: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 1 Pepe –∑–∞ –Ω–∞–∂–∞—Ç–∏–µ",
                min_withdrawal_message_static_general: `–í—ã–≤–æ–¥ —á–µ—Ä–µ–∑ FaucetPay –æ—Ç ${MIN_WITHDRAW_POINTS_FAUCETPAY} –º–æ–Ω–µ—Ç pepe —Ç–æ–ª—å–∫–æ ‚úÖ\n–í—ã–≤–æ–¥ –Ω–∞ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ—à–µ–ª–µ–∫ –æ—Ç ${MIN_WITHDRAW_POINTS} –º–æ–Ω–µ—Ç pepe —Ç–æ–ª—å–∫–æ ‚úÖ`, 
                watched_ads_label: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π", 
                earned_points_label: "–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã Pepe", 
                daily_limit_label: "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã", 
                progress_to_bonus: "–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ –±–æ–Ω—É—Å—É",
                ad_type_label: "–ú–µ–∂—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ Adsgram",
                taps_to_claim: "–Ω–∞–∂–∞—Ç–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã",
                claim_reward_btn: "–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É",
                visit_channel_title: "–ü–æ—Å–µ—Ç–∏—Ç–µ –Ω–∞—à Telegram-–∫–∞–Ω–∞–ª", 
                visit_channel_button: "–ü–æ—Å–µ—Ç–∏—Ç—å –∫–∞–Ω–∞–ª", 
                footer_text: "–ó–∞—â–∏—â–µ–Ω–æ Firebase ‚Ä¢ –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã",
                withdrawal_request_title: "–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥", 
                current_balance_label: "–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:", 
                withdrawal_warning: `–í–Ω–∏–º–∞–Ω–∏–µ üôãüèª‚Äç‚ôÇÔ∏è\n–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ –¥–ª—è FaucetPay —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${MIN_WITHDRAW_POINTS_FAUCETPAY} –º–æ–Ω–µ—Ç pepe.\n–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ –¥–ª—è –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${MIN_WITHDRAW_POINTS} –º–æ–Ω–µ—Ç pepe.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–≤–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –±–µ—Å–ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ (‚óç‚Ä¢·¥ó‚Ä¢‚óç)`, 
                enter_points_placeholder: "–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞ –º–æ–Ω–µ—Ç Pepe", 
                faucetpay_option: "FaucetPay", 
                other_wallet_option: "–í—ã–≤–æ–¥ –Ω–∞ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ—à–µ–ª–µ–∫", 
                wallet_address_placeholder: "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞", 
                withdraw_button: "–í—ã–≤–µ—Å—Ç–∏", 
                ad_loading: "–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–ª–∞–º—ã... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ",
                ad_completed_success: `–†–µ–∫–ª–∞–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! +${POINTS_PER_AD.toFixed(2)} –º–æ–Ω–µ—Ç Pepe –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à —Å—á–µ—Ç`, 
                ad_failed: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∫–ª–∞–º—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
                daily_limit_reached: `–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –ø–æ —Ä–µ–∫–ª–∞–º–µ (${DAILY_AD_LIMIT}). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞.`, 
                min_withdraw_message: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ –¥–ª—è {methodName} —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {minAmount} –º–æ–Ω–µ—Ç pepe.`, 
                insufficient_balance: `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å. –£ –≤–∞—Å {earnedPoints} –º–æ–Ω–µ—Ç pepe.`, 
                enter_wallet_address: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞.", 
                withdrawal_success_message: '–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 
                telegram_send_fail: `–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å: {error}`, 
                telegram_connect_error: `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–ª—É–∂–±–µ Telegram: {error}`, 
                unknown_method: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥:", 
                back_to_main_page: "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É", 
                withdraw_points_btn: "–í—ã–≤–µ—Å—Ç–∏ –º–æ–Ω–µ—Ç—ã Pepe", 
            }
        };

        let currentLanguage = localStorage.getItem('appLanguage') || 'ar'; // Default to Arabic

        // Function to get today's date inYYYY-MM-DD format
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Function to set the language
        window.setLanguage = function(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            document.documentElement.lang = lang; // Set HTML lang attribute

            // Update active button style
            document.querySelectorAll('.language-selector button').forEach(button => {
                if (button.dataset.lang === lang) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });

            // Translate all elements with data-key
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.dataset.key;
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('data-key-placeholder')) {
                        element.placeholder = translations[lang][key];
                    } else if (key === 'ad_completed_success') {
                         element.textContent = translations[lang][key];
                    } else if (key === 'daily_limit_reached') { 
                        element.textContent = translations[lang][key].replace(`(${DAILY_AD_LIMIT})`, `(${DAILY_AD_LIMIT})`); 
                    } else if (key === 'insufficient_balance') {
                        element.textContent = translations[lang][key].replace('{earnedPoints}', earnedPoints.toFixed(2));
                    } else if (key === 'min_withdrawal_message') { 
                        // This specific translation is handled inside withdrawPoints to be dynamic
                    }
                    else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Translate all elements with data-key-placeholder
            document.querySelectorAll('[data-key-placeholder]').forEach(element => {
                const placeholderKey = element.dataset.keyPlaceholder;
                if (translations[lang] && translations[lang][placeholderKey]) {
                    element.placeholder = translations[lang][placeholderKey];
                }
            });

            // Translate options in select dropdowns
            document.querySelectorAll('#payment-method option').forEach(option => {
                const key = option.dataset.key;
                if (translations[lang] && translations[lang][key]) {
                    option.textContent = translations[lang][key];
                }
            });

            // Re-render dynamic content (like numbers)
            earnedPointsEl.textContent = earnedPoints.toFixed(2); 
            adsProgressEl.textContent = `${Math.round((watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100)}%`; 
            showAdNotification(''); 
            withdrawStatusEl.textContent = ''; // Also clear status for withdrawal
            if (withdrawSectionEl.style.display === 'block') { // Update balance if withdrawal form is visible
                currentEarnedPointsEl.textContent = earnedPoints.toFixed(2);
            }
            
            // Update taps remaining text
            tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount;
        };


        // Initialize the app
        function initApp() {
            // Initialize Telegram Web App
            if (WebApp) {
                WebApp.ready();
                WebApp.expand(); // Expand the Mini App to full screen
                // Set theme colors for consistent look
                document.documentElement.style.setProperty('--tg-theme-bg-color', WebApp.themeParams.bg_color);
                document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', WebApp.themeParams.secondary_bg_color);
                document.documentElement.style.setProperty('--tg-theme-text-color', WebApp.themeParams.text_color);
                
                // Set the Telegram user ID and username if available
                if (WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
                    userId = WebApp.initDataUnsafe.user.id;
                    telegramUserName = WebApp.initDataUnsafe.user.username || WebApp.initDataUnsafe.user.first_name || 'User';
                    console.log('Telegram User ID:', userId);
                    console.log('Telegram Username:', telegramUserName);
                } else {
                    console.warn('Telegram initDataUnsafe.user is not available. Using default userId and username.');
                    userId = localStorage.getItem('userId') || 'USR-' + Math.floor(10000 + Math.random() * 90000);
                    localStorage.setItem('userId', userId);
                }
            } else {
                console.warn('Telegram WebApp object not found. Running outside Telegram environment.');
                userId = localStorage.getItem('userId') || 'USR-' + Math.floor(10000 + Math.random() * 90000);
                localStorage.setItem('userId', userId);
            }

            // Load user data
            if (localStorage.getItem('watchedAdsCount')) {
                watchedAdsCount = parseInt(localStorage.getItem('watchedAdsCount'));
                earnedPoints = parseFloat(localStorage.getItem('earnedPoints'));
            }
            
            // Load daily ad watch data
            const todayDate = getTodayDate();
            if (localStorage.getItem('lastWatchDate') === todayDate) {
                dailyWatchedAdsCount = parseInt(localStorage.getItem('dailyWatchedAdsCount')) || 0;
            } else {
                // Reset daily count if it's a new day
                dailyWatchedAdsCount = 0;
                localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount);
            }
            localStorage.setItem('lastWatchDate', todayDate); // Always update last watch date

            // Check if Adsgram SDK is loaded
            if (typeof window.Adsgram === 'undefined' || typeof window.Adsgram.init !== 'function') {
                console.error("Adsgram SDK is NOT loaded. Ad functionality may not work.");
                showAdNotification(translations[currentLanguage].ad_failed); // Notify user about SDK load issue
            } else {
                console.log("Adsgram SDK is loaded successfully.");
            }

            // Apply language on load and update UI
            setLanguage(currentLanguage);
            updateUI();
            updateTapUI(); // Initialize tap UI
            updateButtonStates(); // Set initial button states based on daily limit
        }
        
        // Update UI elements
        function updateUI() {
            earnedPointsEl.textContent = earnedPoints.toFixed(2); 
            
            const progress = (watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100;
            adsProgressEl.textContent = `${Math.round(progress)}%`;
            progressFillEl.style.width = `${progress}%`;
            
            // Add animation when points change
            earnedPointsEl.classList.remove('pulse');
            void earnedPointsEl.offsetWidth; // Trigger reflow
            earnedPointsEl.classList.add('pulse');

            updateButtonStates(); // Ensure button states are updated after UI changes
        }

        // New: Update tap UI elements
        function updateTapUI() {
            tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount;
            if (tapsCount >= TAPS_REQUIRED) {
                claimRewardBtn.style.display = 'block'; // Show claim button
                tapsRemainingEl.style.display = 'none'; // Hide taps remaining
                tapAreaEl.querySelector('p').style.display = 'none'; // Hide "taps to claim" text
            } else {
                claimRewardBtn.style.display = 'none'; // Hide claim button
                tapsRemainingEl.style.display = 'block'; // Show taps remaining
                tapAreaEl.querySelector('p').style.display = 'block'; // Show "taps to claim" text
            }
        }

        // Function to update button enabled/disabled states
        function updateButtonStates() {
            const limitReached = dailyWatchedAdsCount >= DAILY_AD_LIMIT;
            claimRewardBtn.disabled = limitReached; // Disable claim button if limit reached
            if (limitReached) {
                tapAreaEl.style.pointerEvents = 'none'; // Disable tapping
            } else {
                tapAreaEl.style.pointerEvents = 'auto'; // Enable tapping
            }
        }
        
        // New: Handle tap on the tap area
        tapAreaEl.addEventListener('click', (event) => {
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) {
                showAdNotification(translations[currentLanguage].daily_limit_reached);
                return; 
            }

            if (tapsCount < TAPS_REQUIRED) {
                tapsCount++;
                tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount;
                
                // Add visual tap feedback
                const feedback = document.createElement('div');
                feedback.classList.add('tap-feedback');
                feedback.textContent = `+1`;
                // Position feedback relative to the tap area, but use event.clientX/Y for click location
                feedback.style.left = `${event.clientX - tapAreaEl.getBoundingClientRect().left}px`;
                feedback.style.top = `${event.clientY - tapAreaEl.getBoundingClientRect().top}px`;
                tapAreaEl.appendChild(feedback);

                // Add active class to tap area and image for visual feedback
                tapAreaEl.classList.add('active');
                setTimeout(() => {
                    feedback.remove();
                    tapAreaEl.classList.remove('active'); // Remove active class after animation
                }, 1000);

                if (tapsCount >= TAPS_REQUIRED) {
                    updateTapUI();
                }
            }
        });

        // New: Claim reward function (shows ad)
        async function claimReward() {
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) {
                showAdNotification(translations[currentLanguage].daily_limit_reached);
                return; 
            }

            showAdNotification(translations[currentLanguage].ad_loading);
            claimRewardBtn.disabled = true; // Disable button while ad loads
            
            try {
                if (typeof window.Adsgram !== 'undefined' && typeof window.Adsgram.init === 'function') {
                    await window.Adsgram.init({ blockId: "12082" }).show(); 
                    
                    watchedAdsCount++;
                    earnedPoints += POINTS_PER_AD; 
                    dailyWatchedAdsCount++; 

                    // Update last watched date to today
                    localStorage.setItem('lastWatchDate', getTodayDate());
                    localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount);
                    
                    if (watchedAdsCount % ADS_FOR_BONUS === 0) {
                        earnedPoints += 1.00; // Bonus point
                    }
                    
                    localStorage.setItem('watchedAdsCount', watchedAdsCount);
                    localStorage.setItem('earnedPoints', earnedPoints);
                    
                    updateUI(); 
                    showAdNotification(translations[currentLanguage].ad_completed_success);
                    
                    // Reset taps after successful claim
                    tapsCount = 0;
                    updateTapUI();
                } else {
                    console.error("Adsgram SDK is not loaded. Please check the script tag.");
                    showAdNotification(translations[currentLanguage].ad_failed);
                }

            } catch (error) {
                console.error("Adsgram ad error or no ad to show:", error);
                showAdNotification(translations[currentLanguage].ad_failed);
            } finally {
                claimRewardBtn.disabled = false; // Re-enable button
            }
        }
        
        // Show ad notification
        function showAdNotification(message) {
            adNotificationEl.textContent = message;
            adNotificationEl.style.display = 'block';
            
            setTimeout(() => {
                adNotificationEl.style.display = 'none';
            }, 3000);
        }

        // Function to show withdraw form
        function showWithdrawForm() {
            withdrawSectionEl.style.display = 'block';
            // Update the current balance when showing the form
            currentEarnedPointsEl.textContent = earnedPoints.toFixed(2);
        }

        // Function to hide withdraw form
        function hideWithdrawForm() {
            withdrawSectionEl.style.display = 'none';
            withdrawStatusEl.textContent = ''; // Clear status message when hiding
        }

        // Function to handle withdrawal
        function withdrawPoints() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const paymentMethod = document.getElementById('payment-method').value; 
            const walletAddress = document.getElementById('wallet-address').value; 

            let minRequiredPoints;
            let methodName;

            if (paymentMethod === 'faucetpay') {
                minRequiredPoints = MIN_WITHDRAW_POINTS_FAUCETPAY;
                methodName = translations[currentLanguage].faucetpay_option;
            } else { // Covers 'other_wallet' and any default case
                minRequiredPoints = MIN_WITHDRAW_POINTS;
                methodName = translations[currentLanguage].other_wallet_option;
            }

            if (isNaN(amount) || amount < minRequiredPoints) {
                // Use dynamic message for minimum withdrawal
                let message = translations[currentLanguage].min_withdraw_message
                    .replace('{methodName}', methodName)
                    .replace('{minAmount}', minRequiredPoints);
                showTemporaryMessage(message, 'red');
                return;
            }

            if (amount > earnedPoints) {
                let message = translations[currentLanguage].insufficient_balance.replace('{earnedPoints}', earnedPoints.toFixed(2));
                showTemporaryMessage(message, 'red');
                return;
            }

            if (!walletAddress.trim()) { 
                showTemporaryMessage(translations[currentLanguage].enter_wallet_address, 'red');
                return;
            }

            earnedPoints -= amount;
            localStorage.setItem('earnedPoints', earnedPoints.toFixed(2)); 
            updateUI(); // Update main UI after withdrawal
            currentEarnedPointsEl.textContent = earnedPoints.toFixed(2); // Update balance on withdrawal form

            // Construct Telegram message based on selected payment method
            // Use WebApp.initDataUnsafe.user.id for the user ID if available, otherwise use the generated userId
            const actualUserId = WebApp && WebApp.initDataUnsafe && WebApp.initDataUnsafe.user ? WebApp.initDataUnsafe.user.id : userId;
            let messageToAdmin = `New Withdrawal Request:\nUser ID: ${actualUserId}\nUsername: ${telegramUserName}\nAmount: ${amount} pepe coins\nPayment Method: `;
            if (paymentMethod === 'faucetpay') {
                messageToAdmin += `FaucetPay\nWallet Address: ${walletAddress}`;
            } else if (paymentMethod === 'other_wallet') {
                messageToAdmin += `Other Wallet\nWallet Address: ${walletAddress}`;
            } else {
                messageToAdmin += `Unknown Method: ${paymentMethod}\nWallet Address: ${walletAddress}`; 
            }
            
            sendWithdrawRequestToAdmin(messageToAdmin);

            showTemporaryMessage(translations[currentLanguage].withdrawal_success_message, 'green');

            document.getElementById('withdraw-amount').value = '';
            document.getElementById('wallet-address').value = '';
        }

        // Function to send withdrawal request to admin via Telegram
        function sendWithdrawRequestToAdmin(message) {
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_USER_ID}&text=${encodeURIComponent(message)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        console.log('Message sent to admin');
                    } else {
                        console.error('Failed to send message to Telegram:', data.description || data);
                        let errorMessage = translations[currentLanguage].telegram_send_fail.replace('{error}', data.description || data);
                        showTemporaryMessage(errorMessage, 'red');
                    }
                })
                .catch(error => {
                    console.error('Error during fetch to Telegram API:', error);
                    let errorMessage = translations[currentLanguage].telegram_connect_error.replace('{error}', error.message);
                    showTemporaryMessage(errorMessage, 'red');
                });
        }

        // Utility for showing temporary messages
        let messageTimeout;
        function showTemporaryMessage(msg, color) {
            withdrawStatusEl.textContent = msg;
            withdrawStatusEl.style.color = color;
            clearTimeout(messageTimeout);
            messageTimeout = setTimeout(() => {
                withdrawStatusEl.textContent = '';
            }, 5000); 
        }

        // Initialize app on load
        window.onload = initApp;
    </script>
</body>
</html>
