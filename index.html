<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="app_title">Premium Ad Reward System</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>

    <style>
        :root {
            /* Changed primary and secondary colors to vibrant green shades */
            --primary: #00BF63;
            --primary-dark: #008C4A;
            --secondary: #32CD32;
            --secondary-dark: #28A745;
            
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --card-bg: #1f1f1f;
            --gold: #ffd700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), #1a1a2e);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(0, 191, 99, 0.1) 0%, transparent 20%), /* Adjusted for green */
                radial-gradient(circle at 90% 80%, rgba(50, 205, 50, 0.1) 0%, transparent 20%);
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .header {
            /* Header gradient adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0) 50%,
                rgba(255,255,255,0.1) 100%);
            z-index: 1;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .content {
            padding: 25px;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .user-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        /* Updated .stats to center the single card */
        .stats {
            display: flex;
            justify-content: center; /* Center the single card */
            margin: 20px 0;
            text-align: center;
        }
        
        /* Enlarged stat-card for earned points */
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px 30px; /* Increased padding */
            width: 80%;
            /* Made it wider */
            max-width: 300px;
            /* Max width to keep it reasonable */
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            margin-bottom: 20px; /* Space between points card and ad container */
        }
        
        .stat-card h3 {
            font-size: 18px;
            /* Larger font for title */
            margin-bottom: 10px;
            /* More space */
            color: #aaa;
        }
        
        .stat-card .value {
            font-size: 36px;
            /* Significantly larger font for value */
            font-weight: 700;
            color: var(--primary); 
        }
        
        .progress-container {
            margin: 25px 0;
            text-align: center;
        }
        
        .progress-label {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            /* Progress bar fill adjusted for green */
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            width: 30%;
            transition: width 0.5s ease;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        /* 3D Button Styles - Adjusted for green */
        .btn-3d {
            position: relative;
            padding: 16px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            text-align: center;
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            perspective: 500px;
            /* Box shadow uses primary-dark for depth */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Gradient background for button surface */
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .btn-3d::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            /* Shiny effect on hover */
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .btn-3d:hover {
            transform: translateY(4px);
            /* Adjust shadow on hover */
            box-shadow: 
                0 4px 0 var(--primary-dark),
                0 8px 10px rgba(0, 0, 0, 0.3);
        }
        
        .btn-3d:hover::after {
            left: 100%;
        }
        
        .btn-3d:active {
            transform: translateY(8px);
            /* Flatten shadow on click */
            box-shadow: 
                0 0 0 var(--primary-dark),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            /* Secondary button uses secondary-dark for shadow */
            box-shadow: 
                0 8px 0 var(--secondary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary::before {
            /* Secondary button background gradient */
            background: linear-gradient(45deg, var(--secondary), var(--primary-dark));
        }
        
        .btn-blue { /* This class is now essentially the same as btn-3d due to shared primary/secondary colors */
            box-shadow: 
                0 8px 0 var(--primary-dark), 
                0 15px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-blue::before {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
        }
        
        .website-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .website-section h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #777;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .firebase-logo {
            display: inline-block;
            margin-top: 10px;
            font-size: 10px;
            background: rgba(255, 152, 0, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            color: #ffa726;
        }
        
        .ad-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .ad-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        /* Animation for ad watching */
        @keyframes pulse {
            0% { transform: scale(1);
            }
            50% { transform: scale(1.05);
            }
            100% { transform: scale(1);
            }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        .ad-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px;
            }
            .tap-area {
                width: 180px;
                height: 180px;
            }
            .tap-area img {
                width: 100%;
                height: 100%;
            }
            .tap-area h2 {
                font-size: 36px;
            }
            .tap-area p {
                font-size: 16px;
            }
            .stat-card { /* Adjust for smaller screens */
                width: 95%;
                padding: 15px 20px;
            }
            .stat-card h3 {
                font-size: 16px;
            }
            .stat-card .value {
                font-size: 30px;
            }
        }
        
        /* Language Selector Styles - Active button gradient adjusted for green */
        .language-selector {
            position: absolute;
            top: 15px; 
            right: 15px; 
            display: flex;
            gap: 5px;
            z-index: 999; 
            background-color: rgba(0, 0, 0, 0.3); 
            border-radius: 10px; 
            padding: 5px;
            backdrop-filter: blur(5px); 
        }
        .language-selector button {
            width: auto;
            padding: 5px 10px;
            font-size: 13px;
            background-color: rgba(255, 255, 255, 0.1); 
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; 
            cursor: pointer;
            min-width: 30px;
            transition: all 0.2s ease;
        }
        .language-selector button.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-color: var(--primary); 
        }
        .language-selector button:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Withdrawal Section Styles - Adapted to be integrated */
        .withdraw-section {
            margin-top: 20px;
            display: none; /* Hidden by default, shown by JS */
            padding: 25px;
            background-color: rgba(255, 255, 255, 0.05); 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .withdraw-section h3 {
            color: var(--secondary);
            margin-bottom: 5px; 
            font-size: 20px;
            font-weight: 600;
        }
        .withdraw-section .warning-message { 
            font-size: 13px;
            color: #FFC107; 
            margin-bottom: 15px;
            line-height: 1.4;
            white-space: pre-wrap; 
            background: rgba(255, 215, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #FFD700;
        }
        .withdraw-section input, 
        .withdraw-section select { 
            width: 100%;
            padding: 12px;
            margin: 10px 0; 
            border-radius: 10px; 
            border: 1px solid var(--primary); 
            background-color: var(--dark); 
            color: var(--light);
            font-size: 14px;
        }
        .withdraw-section input::placeholder {
            color: #aaa;
        }
        .withdraw-section input:focus, 
        .withdraw-section select:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }
        .withdraw-section button {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 100%;
            padding: 14px; 
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px; 
            border-radius: 15px; 
            cursor: pointer;
            color: white; 
            border: none;
            box-shadow: 0 8px 0 var(--primary-dark), 0 15px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        .withdraw-section button:hover {
            transform: translateY(4px);
            box-shadow: 0 4px 0 var(--primary-dark), 0 8px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }
        .withdraw-section button:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 var(--primary-dark), 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .withdraw-section p.current-balance {
            font-size: 18px;
            color: var(--gold);
            margin-bottom: 25px;
            font-weight: 600;
        }

        .back-button-container {
            margin-top: 25px;
            text-align: center;
        }
        .back-button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            padding: 10px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-size: 14px;
            transition: background-color 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: inline-block; /* Make it a block for centering */
        }
        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Hamster Kombat Style Tap Area */
        .tap-area {
            background: radial-gradient(circle at center, #2e2e2e 0%, #1a1a1a 100%);
            border-radius: 50%; /* Make it circular */
            margin: 20px auto;
            /* Center the circular area */
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            position: relative;
            width: 220px;
            /* Set fixed width and height for a perfect circle */
            height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.5);
            /* Added outer shadow */
            animation: backgroundPulse 5s infinite alternate;
            user-select: none; /* Prevent text selection on tap */
            -webkit-user-select: none;
            /* Safari */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* IE10+ */
        }

        /* Image inside the tap area */
        .tap-area img {
            width: 100%;
            /* Make image fill the circle's width */
            height: 100%;
            /* Make image fill the circle's height */
            object-fit: cover;
            /* Make image cover the area, cropping if necessary */
            border-radius: 50%;
            /* Ensure image itself is circular */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 5; /* Place image behind text but above background pulse */
            transition: transform 0.1s ease;
        }

        .tap-area.active img {
            transform: scale(0.95);
            /* Shrink image on tap */
        }

        @keyframes backgroundPulse {
            0% { background: radial-gradient(circle at center, #2e2e2e 0%, #1a1a1a 100%);
            }
            100% { background: radial-gradient(circle at center, #3a3a3a 0%, #2a2a2a 100%);
            }
        }

        .tap-area h2 {
            font-size: 48px;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 5px; /* Adjusted margin */
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
            transition: transform 0.1s ease;
            position: relative;
            z-index: 10; /* Ensure text is above image */
        }

        .tap-area p {
            font-size: 18px;
            color: #ccc;
            margin-top: 0; /* Adjusted margin */
            position: relative;
            z-index: 10; /* Ensure text is above image */
        }

        .tap-feedback {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: var(--gold);
            opacity: 0;
            pointer-events: none;
            animation: fadeOutUp 1s forwards;
            text-shadow: 0 0 5px rgba(255,215,0,0.8);
            z-index: 20;
        }

        @keyframes fadeOutUp {
            0% { transform: translateY(0);
            opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0;
            }
        }

        .tap-button-container {
            margin-top: 20px;
            text-align: center;
        }

        .tap-claim-btn {
            display: none;
            /* Hidden by default */
            position: relative;
            padding: 16px 30px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            color: white;
            background: linear-gradient(90deg, #28a745, #218838);
            /* Green gradient */
            box-shadow: 
                0 8px 0 #1e7e34, 
                0 15px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            perspective: 500px;
            overflow: hidden;
            z-index: 1;
        }

        .tap-claim-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #28a745, #218838); 
            z-index: -1;
            transition: all 0.3s ease;
        }
        
        .tap-claim-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        .tap-claim-btn:hover {
            transform: translateY(4px);
            box-shadow: 
                0 4px 0 #1e7e34,
                0 8px 10px rgba(0, 0, 0, 0.3);
        }
        
        .tap-claim-btn:hover::after {
            left: 100%;
        }
        
        .tap-claim-btn:active {
            transform: translateY(8px);
            box-shadow: 
                0 0 0 #1e7e34,
                0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .tap-claim-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 8px 0 #1e7e34, 
                        0 15px 20px rgba(0, 0, 0, 0.4);
        }

        .points-per-tap-message {
            font-size: 16px;
            color: var(--light);
            margin-top: 15px; /* Spacing below the circle/claim button */
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="ad-notification" id="ad-notification"></div>
    
    <div class="container">
        <div class="language-selector">
            <button data-lang="ar" onclick="setLanguage('ar')">AR</button>
            <button data-lang="en" onclick="setLanguage('en')">EN</button>
            <button data-lang="ru" onclick="setLanguage('ru')">RU</button>
        </div>

        <div class="header">
            <h1 data-key="app_title">⛏️شغل المشاهده التلقائيه وادهب لي النوم 😴واستمتع بي الارباح🤫💵</h1>
        </div>
        
        <div class="content">
            <div class="user-info">
                <p data-key="earn_per_click_message">اربح 5 عملات pepe لكل نقرة🔥</p>
                <p data-key="min_withdrawal_message_static_general">السحب عن طريق FaucetPay من 10 عملات فقط ✅<br>السحب إلى أي محفظة أخرى من 100 عملة فقط ✅</p>
            </div>
            
            <div class="stats"> 
                <div class="stat-card">
                    <h3 data-key="earned_points_label">عملات Pepe المكتسبة</h3>
                    <div class="value" id="earned-points">0.00</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-label">
                    <span data-key="progress_to_bonus">التقدم للمكافأة</span>
                    <span id="ads-progress">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            
            <div class="ad-container">
                <div class="ad-label" data-key="ad_type_label">إعلان Adexium Widget</div>
                
                <div class="tap-area" id="tap-area">
                    <img src="https://f.top4top.io/p_3464tveeu0.jpeg" alt="Pepe Coin Image" onerror="this.onerror=null;this.src='https://placehold.co/220x220/00BF63/FFFFFF?text=Pepe+Coin';">
                    <h2 id="taps-remaining">10</h2>
                    <p data-key="taps_to_claim">نقرة للمطالبة بالمكافأة</p>
                </div>

                <div class="tap-button-container">
                    <button class="btn-3d tap-claim-btn" id="claim-reward-btn" onclick="claimReward()" data-key="claim_reward_btn">المطالبة بالمكافأة</button>
                </div>
                
                <p class="points-per-tap-message" data-key="points_per_tap_message">اربح 1 Pepe لكل نقرة</p>

            </div>
            
            <div class="website-section">
                <h3 data-key="visit_channel_title">قم بزيارة قناتنا على تيليجرام</h3>
                <button class="btn-3d btn-blue" onclick="window.open('https://t.me/dogsarn', '_blank')" data-key="visit_channel_button">زيارة القناة</button>
            </div>

            <div class="buttons">
                <button class="btn-3d btn-blue" id="show-withdraw-btn" onclick="showWithdrawForm()" data-key="withdraw_points_btn">سحب عملات Pepe</button>
            </div>

            <div class="withdraw-section" id="withdraw-section">
                <h3 data-key="withdrawal_request_title">طلب السحب</h3>
                <p class="current-balance" data-key="current_balance_label">رصيدك الحالي: <span id="current-earned-points">0.00</span> عملة Pepe</p>
                <p class="warning-message" data-key="withdrawal_warning">تنبيه 🙋🏻‍♂️
الحد الأدنى للسحب عن طريق FaucetPay هو 10 عملات pepe.
الحد الأدنى للسحب إلى أي محفظة أخرى هو 100 عملة pepe.
يرجى التأكد من إدخال عنوان محفظة صحيح لتلقي السحب بدون مشاكل (◍•ᴗ•◍)</p>
                <input type="number" id="withdraw-amount" data-key-placeholder="enter_points_placeholder" placeholder="أدخل الكمية لسحب عملات Pepe" />
                <select id="payment-method"> 
                    <option value="faucetpay" data-key="faucetpay_option">FaucetPay</option>
                    <option value="other_wallet" data-key="other_wallet_option">السحب إلى أي محفظة أخرى</option>
                </select>
                <input type="text" id="wallet-address" data-key-placeholder="wallet_address_placeholder" placeholder="أدخل عنوان المحفظة" /> 
                <button onclick="withdrawPoints()" data-key="withdraw_button">سحب</button>
                <p id="withdraw-status"></p>

                <div class="back-button-container">
                    <a href="#" class="back-button" onclick="hideWithdrawForm(); return false;" data-key="back_to_main_page">العودة إلى الواجهة الرئيسية</a>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p data-key="footer_text">مؤمن بواسطة Firebase • جميع المعاملات محمية</p>
            <div class="firebase-logo">Firebase</div>
        </div>
    </div>

    <script>
        // Constants
        const POINTS_PER_AD = 1.00; // Reward per ad is now 1.00 Pepe Coins for 10 taps [cite: 187]
        const TAPS_REQUIRED = 10; // Number of taps required to claim reward [cite: 188]
        const ADS_FOR_BONUS = 10; // [cite: 189]
        const MIN_WITHDRAW_POINTS = 100; // Minimum withdrawal for other wallets [cite: 189]
        const MIN_WITHDRAW_POINTS_FAUCETPAY = 10; // Minimum withdrawal for FaucetPay [cite: 190]
        const DAILY_AD_LIMIT = 100; // Daily limit for ads watched is now 100 [cite: 191]
        const ADMIN_USER_ID = "-1002705355317"; // [cite: 192]
        const BOT_TOKEN = "7509054222:AAFhFhVXFCOs4kXtHQBigGU2QeNamHX42LQ"; // [cite: 192]
        
        // State variables
        let watchedAdsCount = 0; // [cite: 193]
        let earnedPoints = 0.00; // [cite: 193]
        let dailyWatchedAdsCount = 0; // [cite: 193]
        let lastWatchDate = ""; // [cite: 193]
        let tapsCount = 0; // New: Counter for taps [cite: 194]
        let autoAdInterval; // Keep for potential future use or removal [cite: 195]
        let userId = null; // [cite: 196]
        const telegramUserName = "💲💲"; // [cite: 196]

        // DOM Elements
        // Removed watchedAdsEl and dailyWatchedAdsEl
        const earnedPointsEl = document.getElementById('earned-points'); // [cite: 197]
        const adsProgressEl = document.getElementById('ads-progress'); // [cite: 197]
        const progressFillEl = document.getElementById('progress-fill'); // [cite: 197]
        const adNotificationEl = document.getElementById('ad-notification'); // [cite: 198]
        // Withdrawal Section DOM elements
        const withdrawSectionEl = document.getElementById('withdraw-section'); // [cite: 198]
        const withdrawStatusEl = document.getElementById('withdraw-status'); // [cite: 199]
        const currentEarnedPointsEl = document.getElementById('current-earned-points'); // [cite: 199]

        const tapAreaEl = document.getElementById('tap-area'); // New: Tap area element [cite: 199]
        const tapsRemainingEl = document.getElementById('taps-remaining'); // New: Taps remaining element [cite: 200]
        const claimRewardBtn = document.getElementById('claim-reward-btn'); // New: Claim reward button [cite: 201]
        const tapImageEl = tapAreaEl.querySelector('img'); // New: Image inside tap area [cite: 202]
        
        // --- Translation Logic ---
        const translations = {
            ar: {
                app_title: "⛏️شغل المشاهده التلقائيه وادهب لي النوم 😴واستمتع بي الارباح🤫💵", // [cite: 170]
                earn_per_click_message: "اربح 5 عملات pepe لكل نقرة🔥", // [cite: 170]
                points_per_tap_message: "اربح 1 Pepe لكل نقرة", // [cite: 203]
                min_withdrawal_message_static_general: `السحب عن طريق FaucetPay من ${MIN_WITHDRAW_POINTS_FAUCETPAY} عملات فقط ✅\nالسحب إلى أي محفظة أخرى من ${MIN_WITHDRAW_POINTS} عملة فقط ✅`, // [cite: 171]
                watched_ads_label: "الإعلانات المشاهدة", 
                earned_points_label: "عملات Pepe المكتسبة", // [cite: 172, 204]
                daily_limit_label: "المشاهدات اليومية", 
                progress_to_bonus: "التقدم للمكافأة", // [cite: 173]
                ad_type_label: "إعلان Adexium Widget", // Changed ad type label
                taps_to_claim: "نقرة للمطالبة بالمكافأة", // [cite: 176]
                claim_reward_btn: "المطالبة بالمكافأة", // [cite: 177, 205]
                visit_channel_title: "قم بزيارة قناتنا على تيليجرام", // [cite: 178]
                visit_channel_button: "زيارة القناة", // [cite: 178]
                footer_text: "مؤمن بواسطة Firebase • جميع المعاملات محمية", // [cite: 67]
                withdrawal_request_title: "طلب السحب", // [cite: 180, 206]
                current_balance_label: "رصيدك الحالي:", // [cite: 180, 206]
                withdrawal_warning: `تنبيه 🙋🏻‍♂️\nالحد الأدنى للسحب عن طريق FaucetPay هو ${MIN_WITHDRAW_POINTS_FAUCETPAY} عملات pepe.\nالحد الأدنى للسحب إلى أي محفظة أخرى هو ${MIN_WITHDRAW_POINTS} عملة pepe.\nيرجى التأكد من إدخال عنوان محفظة صحيح لتلقي السحب بدون مشاكل (◍•ᴗ•◍)`, // [cite: 180, 181, 182]
                enter_points_placeholder: "أدخل الكمية لسحب عملات Pepe", // [cite: 182]
                faucetpay_option: "FaucetPay", // [cite: 182, 207]
                other_wallet_option: "السحب إلى أي محفظة أخرى", // [cite: 183, 207]
                wallet_address_placeholder: "أدخل عنوان المحفظة", // [cite: 183, 207]
                withdraw_button: "سحب", // [cite: 183, 207]
                ad_loading: "جاري تحميل الإعلان... يرجى الانتظار", // [cite: 207]
                ad_completed_success: `اكتمل الإعلان! تمت إضافة ${POINTS_PER_AD.toFixed(2)} عملة pepe إلى حسابك`, // [cite: 208]
                ad_failed: "فشل عرض الإعلان. يرجى المحاولة مرة أخرى.", // [cite: 208]
                daily_limit_reached: `لقد وصلت للحد الأقصى من المشاهدات اليومية (${DAILY_AD_LIMIT}). يرجى المحاولة غدًا.`, // [cite: 209]
                min_withdraw_message: `الحد الأدنى للسحب عن طريق {methodName} هو {minAmount} عملة pepe.`, // [cite: 209]
                insufficient_balance: `رصيدك غير كافٍ. لديك {earnedPoints} عملة pepe.`, // [cite: 210]
                enter_wallet_address: "يرجى إدخال عنوان المحفظة.", // [cite: 210]
                withdrawal_success_message: 'تم إرسال طلب السحب بنجاح!', // [cite: 210]
                telegram_send_fail: `فشل إرسال الطلب: {error}`, // [cite: 211]
                telegram_connect_error: `خطأ في الاتصال بخدمة تيليجرام: {error}`, // [cite: 211]
                unknown_method: "طريقة غير معروفة:", // [cite: 211]
                back_to_main_page: "العودة إلى الواجهة الرئيسية", // [cite: 185, 211]
                withdraw_points_btn: "سحب عملات Pepe", // [cite: 179, 212]
            },
            en: {
                app_title: "⛏️Enable Auto Watch, Go to Sleep 😴, and Enjoy the Profits🤫💵", // [cite: 212]
                earn_per_click_message: "Earn 5 Pepe coins per click🔥", // [cite: 212]
                points_per_tap_message: "Earn 1 Pepe per tap", // [cite: 212]
                min_withdrawal_message_static_general: `Withdrawal via FaucetPay from ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins only ✅\nWithdrawal to Any Other Wallet from ${MIN_WITHDRAW_POINTS} pepe coins only ✅`, // [cite: 213]
                watched_ads_label: "Watched Ads", // [cite: 213]
                earned_points_label: "Earned Pepe Coins", // [cite: 213]
                daily_limit_label: "Daily Views", // [cite: 213]
                progress_to_bonus: "Progress to Bonus", // [cite: 214]
                ad_type_label: "Adexium Widget Interstitial Ad", // Changed ad type label
                taps_to_claim: "taps to claim reward", // [cite: 214]
                claim_reward_btn: "Claim Reward", // [cite: 214]
                visit_channel_title: "Visit Our Telegram Channel", // [cite: 214]
                visit_channel_button: "Visit Channel", // [cite: 214]
                footer_text: "Secured by Firebase • All transactions are protected", // [cite: 214]
                withdrawal_request_title: "Withdrawal Request", // [cite: 215]
                current_balance_label: "Your Current Balance:", // [cite: 215]
                withdrawal_warning: `Warning 🙋🏻‍♂️\nMinimum withdrawal for FaucetPay is ${MIN_WITHDRAW_POINTS_FAUCETPAY} pepe coins.\nMinimum withdrawal for Any Other Wallet is ${MIN_WITHDRAW_POINTS} pepe coins.\nPlease ensure you enter a correct wallet address for smooth withdrawals (◍•ᴗ•◍)`, // [cite: 215]
                enter_points_placeholder: "Enter Amount to Withdraw Pepe Coins", // [cite: 215]
                faucetpay_option: "FaucetPay", // [cite: 216]
                other_wallet_option: "Withdraw to Any Other Wallet", // [cite: 216]
                wallet_address_placeholder: "Enter Wallet Address", // [cite: 216]
                withdraw_button: "Withdraw", // [cite: 216]
                ad_loading: "Loading ad... Please wait", // [cite: 216]
                ad_completed_success: `Ad completed! +${POINTS_PER_AD.toFixed(2)} Pepe Coins added to your account`, // [cite: 217]
                ad_failed: "Failed to show ad. Please try again.", // [cite: 217]
                daily_limit_reached: `You have reached the daily ad limit (${DAILY_AD_LIMIT}). Please try again tomorrow.`, // [cite: 218]
                min_withdraw_message: `Minimum withdrawal for {methodName} is {minAmount} pepe coins.`, // [cite: 218]
                insufficient_balance: `Insufficient balance. You have {earnedPoints} Pepe Coins.`, // [cite: 219]
                enter_wallet_address: "Please enter the wallet address.", // [cite: 219]
                withdrawal_success_message: 'Withdrawal request sent successfully!', // [cite: 219]
                telegram_send_fail: `Failed to send request: {error}`, // [cite: 219]
                telegram_connect_error: `Error connecting to Telegram service: {error}`, // [cite: 220]
                unknown_method: "Unknown Method:", // [cite: 220]
                back_to_main_page: "Back to Main Page", // [cite: 220]
                withdraw_points_btn: "Withdraw Pepe Coins", // [cite: 220]
            },
            ru: {
                app_title: "⛏️Включи автопросмотр и иди спать 😴, наслаждайся прибылью🤫💵", // [cite: 221]
                earn_per_click_message: "Заработайте 5 монет Pepe за клик🔥", // [cite: 221]
                points_per_tap_message: "Заработайте 1 Pepe за нажатие", // [cite: 222]
                min_withdrawal_message_static_general: `Вывод через FaucetPay от ${MIN_WITHDRAW_POINTS_FAUCETPAY} монет pepe только ✅\nВывод на любой другой кошелек от ${MIN_WITHDRAW_POINTS} монет pepe только ✅`, // [cite: 222]
                watched_ads_label: "Просмотрено объявлений", // [cite: 222]
                earned_points_label: "Заработанные монеты Pepe", // [cite: 222]
                daily_limit_label: "Ежедневные просмотры", // [cite: 223]
                progress_to_bonus: "Прогресс к бонусу", // [cite: 223]
                ad_type_label: "Межстраничная реклама Adexium Widget", // Changed ad type label
                taps_to_claim: "нажатий для получения награды", // [cite: 223]
                claim_reward_btn: "Получить награду", // [cite: 223]
                visit_channel_title: "Посетите наш Telegram-канал", // [cite: 223]
                visit_channel_button: "Посетить канал", // [cite: 223]
                footer_text: "Защищено Firebase • Все транзакции защищены", // [cite: 223]
                withdrawal_request_title: "Запрос на вывод", // [cite: 224]
                current_balance_label: "Ваш текущий баланс:", // [cite: 224]
                withdrawal_warning: `Внимание 🙋🏻‍♂️\nМинимальная сумма вывода для FaucetPay составляет ${MIN_WITHDRAW_POINTS_FAUCETPAY} монет pepe.\nМинимальная сумма вывода для любого другого кошелька составляет ${MIN_WITHDRAW_POINTS} монет pepe.\nПожалуйста, убедитесь, что вы ввели правильный адрес кошелька для беспроблемного вывода средств (◍•ᴗ•◍)`, // [cite: 224]
                enter_points_placeholder: "Введите сумму для вывода монет Pepe", // [cite: 224]
                faucetpay_option: "FaucetPay", // [cite: 225]
                other_wallet_option: "Вывод на любой другой кошелек", // [cite: 225]
                wallet_address_placeholder: "Введите адрес кошелька", // [cite: 225]
                withdraw_button: "Вывести", // [cite: 225]
                ad_loading: "Загрузка рекламы... Пожалуйста, подождите", // [cite: 226]
                ad_completed_success: `Реклама завершена! +${POINTS_PER_AD.toFixed(2)} монет Pepe добавлено на ваш счет`, // [cite: 226]
                ad_failed: "Не удалось показать рекламу. Пожалуйста, попробуйте еще раз.", // [cite: 226]
                daily_limit_reached: `Вы достигли дневного лимита по рекламе (${DAILY_AD_LIMIT}). Пожалуйста, попробуйте завтра.`, // [cite: 227]
                min_withdraw_message: `Минимальная сумма вывода для {methodName} составляет {minAmount} монет pepe.`, // [cite: 227]
                insufficient_balance: `Недостаточный баланс. У вас {earnedPoints} монет pepe.`, // [cite: 228]
                enter_wallet_address: "Пожалуйста, введите адрес кошелька.", // [cite: 228]
                withdrawal_success_message: 'Запрос на вывод успешно отправлен!', // [cite: 228]
                telegram_send_fail: `Не удалось отправить запрос: {error}`, // [cite: 228]
                telegram_connect_error: `Ошибка подключения к службе Telegram: {error}`, // [cite: 229]
                unknown_method: "Неизвестный метод:", // [cite: 229]
                back_to_main_page: "Вернуться на главную страницу", // [cite: 229]
                withdraw_points_btn: "Вывести монеты Pepe", // [cite: 229]
            }
        };
        let currentLanguage = localStorage.getItem('appLanguage') || 'ar'; // Default to Arabic [cite: 230]

        // Initialize Adexium Widget
        let adexiumWidget;
        document.addEventListener('DOMContentLoaded', () => {
            adexiumWidget = new AdexiumWidget({wid: '4eb29add-64fa-4070-a641-ad1f330778de', adFormat: 'interstitial'});
            adexiumWidget.init();
        });


        // Function to get today's date inYYYY-MM-DD format
        function getTodayDate() {
            const today = new Date(); // [cite: 231]
            const year = today.getFullYear(); // [cite: 231]
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed [cite: 232]
            const day = String(today.getDate()).padStart(2, '0'); // [cite: 233]
            return `${year}-${month}-${day}`; // [cite: 233]
        }

        // Function to set the language
        window.setLanguage = function(lang) {
            currentLanguage = lang; // [cite: 234]
            localStorage.setItem('appLanguage', lang); // [cite: 234]
            document.documentElement.lang = lang; // Set HTML lang attribute [cite: 234]

            // Update active button style [cite: 235]
            document.querySelectorAll('.language-selector button').forEach(button => { // [cite: 235]
                if (button.dataset.lang === lang) { // [cite: 235]
                    button.classList.add('active'); // [cite: 236]
                } else {
                    button.classList.remove('active'); // [cite: 236]
                }
            });
            // Translate all elements with data-key [cite: 236]
            document.querySelectorAll('[data-key]').forEach(element => { // [cite: 237]
                const key = element.dataset.key; // [cite: 237]
                if (translations[lang] && translations[lang][key]) { // [cite: 237]
                    if (element.tagName === 'INPUT' && element.hasAttribute('data-key-placeholder')) { // [cite: 237]
                        element.placeholder = translations[lang][key]; // [cite: 238]
                    } else if (key === 'ad_completed_success') { // [cite: 238]
                         element.textContent = translations[lang][key]; // [cite: 238]
                    } else if (key === 'daily_limit_reached') { // [cite: 238]
                        element.textContent = translations[lang][key].replace(`(${DAILY_AD_LIMIT})`, `(${DAILY_AD_LIMIT})`); // [cite: 238]
                    } else if (key === 'insufficient_balance') { // [cite: 238]
                        element.textContent = translations[lang][key].replace('{earnedPoints}', earnedPoints.toFixed(2)); // [cite: 239]
                    } else if (key === 'min_withdrawal_message') { // [cite: 239]
                        // This specific translation is handled inside withdrawPoints to be dynamic
                    }
                    else {
                        element.textContent = translations[lang][key]; // [cite: 240]
                    }
                }
            });
            // Translate all elements with data-key-placeholder [cite: 241]
            document.querySelectorAll('[data-key-placeholder]').forEach(element => { // [cite: 242]
                const placeholderKey = element.dataset.keyPlaceholder; // [cite: 242]
                if (translations[lang] && translations[lang][placeholderKey]) { // [cite: 242]
                    element.placeholder = translations[lang][placeholderKey]; // [cite: 242]
                }
            });

            // Translate options in select dropdowns [cite: 243]
            document.querySelectorAll('#payment-method option').forEach(option => { // [cite: 243]
                const key = option.dataset.key; // [cite: 243]
                if (translations[lang] && translations[lang][key]) { // [cite: 243]
                    option.textContent = translations[lang][key]; // [cite: 243]
                }
            });
            // Re-render dynamic content (like numbers) [cite: 244]
            // watchedAdsEl.textContent = watchedAdsCount; // Removed [cite: 245]
            earnedPointsEl.textContent = earnedPoints.toFixed(2); // [cite: 245, 246]
            // dailyWatchedAdsEl.textContent = `${dailyWatchedAdsCount} / ${DAILY_AD_LIMIT}`; // Removed [cite: 246]
            adsProgressEl.textContent = `${Math.round((watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100)}%`; // [cite: 247]
            showAdNotification(''); // [cite: 247]
            withdrawStatusEl.textContent = ''; // Also clear status for withdrawal [cite: 247]
            if (withdrawSectionEl.style.display === 'block') { // Update balance if withdrawal form is visible [cite: 247]
                currentEarnedPointsEl.textContent = earnedPoints.toFixed(2); // [cite: 248]
            }
            
            // Update taps remaining text
            tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount; // [cite: 249]
        };


        // Initialize the app
        function initApp() {
            // Load user data
            if (localStorage.getItem('watchedAdsCount')) { // [cite: 250]
                watchedAdsCount = parseInt(localStorage.getItem('watchedAdsCount')); // [cite: 250]
                earnedPoints = parseFloat(localStorage.getItem('earnedPoints')); // [cite: 250]
            }
            
            // Load daily ad watch data
            const todayDate = getTodayDate(); // [cite: 251]
            if (localStorage.getItem('lastWatchDate') === todayDate) { // [cite: 251]
                dailyWatchedAdsCount = parseInt(localStorage.getItem('dailyWatchedAdsCount')) || 0; // [cite: 252]
            } else {
                // Reset daily count if it's a new day
                dailyWatchedAdsCount = 0; // [cite: 253]
                localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount); // [cite: 253]
            }
            localStorage.setItem('lastWatchDate', todayDate); // Always update last watch date [cite: 254]

            // userId is no longer used for display. [cite: 255]
            if (!localStorage.getItem('userId')) { // [cite: 255]
                const newUserId = 'USR-' + Math.floor(10000 + Math.random() * 90000); // [cite: 256]
                localStorage.setItem('userId', newUserId); // [cite: 256]
            }
            
            // Check if Adexium Widget SDK is loaded
            if (typeof window.AdexiumWidget === 'undefined') {
                console.error("Adexium Widget SDK is NOT loaded. Ad functionality may not work.");
                showAdNotification(translations[currentLanguage].ad_failed);
            } else {
                console.log("Adexium Widget SDK is loaded successfully.");
            }

            // Apply language on load and update UI
            setLanguage(currentLanguage); // [cite: 259]
            updateUI(); // [cite: 259]
            updateTapUI(); // Initialize tap UI [cite: 259]
            updateButtonStates(); // Set initial button states based on daily limit [cite: 260]
        }
        
        // Update UI elements
        function updateUI() {
            // watchedAdsEl.textContent = watchedAdsCount; // Removed [cite: 261]
            earnedPointsEl.textContent = earnedPoints.toFixed(2); // [cite: 262]
            // dailyWatchedAdsEl.textContent = `${dailyWatchedAdsCount} / ${DAILY_AD_LIMIT}`; // Removed [cite: 262]
            
            const progress = (watchedAdsCount % ADS_FOR_BONUS) / ADS_FOR_BONUS * 100; // [cite: 263]
            adsProgressEl.textContent = `${Math.round(progress)}%`; // [cite: 263]
            progressFillEl.style.width = `${progress}%`; // [cite: 263]
            
            // Add animation when points change [cite: 264]
            earnedPointsEl.classList.remove('pulse'); // [cite: 264]
            void earnedPointsEl.offsetWidth; // Trigger reflow [cite: 264]
            earnedPointsEl.classList.add('pulse'); // [cite: 264]

            updateButtonStates(); // Ensure button states are updated after UI changes [cite: 265]
        }

        // New: Update tap UI elements
        function updateTapUI() {
            tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount; // [cite: 266]
            if (tapsCount >= TAPS_REQUIRED) { // [cite: 266]
                claimRewardBtn.style.display = 'block'; // Show claim button [cite: 267]
                tapsRemainingEl.style.display = 'none'; // Hide taps remaining [cite: 268]
                tapAreaEl.querySelector('p').style.display = 'none'; // Hide "taps to claim" text [cite: 269]
            } else {
                claimRewardBtn.style.display = 'none'; // Hide claim button [cite: 270]
                tapsRemainingEl.style.display = 'block'; // Show taps remaining [cite: 271]
                tapAreaEl.querySelector('p').style.display = 'block'; // Show "taps to claim" text [cite: 272]
            }
        }

        // Function to update button enabled/disabled states
        function updateButtonStates() {
            const limitReached = dailyWatchedAdsCount >= DAILY_AD_LIMIT; // [cite: 273]
            claimRewardBtn.disabled = limitReached; // Disable claim button if limit reached [cite: 273]
            if (limitReached) { // [cite: 273]
                tapAreaEl.style.pointerEvents = 'none'; // Disable tapping [cite: 274]
            } else {
                tapAreaEl.style.pointerEvents = 'auto'; // Enable tapping [cite: 275]
            }
        }
        
        // New: Handle tap on the tap area
        tapAreaEl.addEventListener('click', (event) => { // [cite: 276]
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) { // [cite: 276]
                showAdNotification(translations[currentLanguage].daily_limit_reached); // [cite: 276]
                return; // [cite: 276]
            }

            if (tapsCount < TAPS_REQUIRED) { // [cite: 276]
                tapsCount++; // [cite: 277]
                tapsRemainingEl.textContent = TAPS_REQUIRED - tapsCount; // [cite: 277]
                
                // Add visual tap feedback [cite: 277]
                const feedback = document.createElement('div'); // [cite: 278]
                feedback.classList.add('tap-feedback'); // [cite: 278]
                feedback.textContent = `+1`; // [cite: 278]
                // Position feedback relative to the tap area, but use event.clientX/Y for click location
                feedback.style.left = `${event.clientX - tapAreaEl.getBoundingClientRect().left}px`; // [cite: 279]
                feedback.style.top = `${event.clientY - tapAreaEl.getBoundingClientRect().top}px`; // [cite: 279]
                tapAreaEl.appendChild(feedback); // [cite: 279]

                // Add active class to tap area and image for visual feedback [cite: 279]
                tapAreaEl.classList.add('active'); // [cite: 280]
                setTimeout(() => { // [cite: 280]
                    feedback.remove(); // [cite: 281]
                    tapAreaEl.classList.remove('active'); // Remove active class after animation [cite: 281]
                }, 1000); // [cite: 281]
                if (tapsCount >= TAPS_REQUIRED) { // [cite: 281]
                    updateTapUI(); // [cite: 282]
                }
            }
        });
        // New: Claim reward function (shows ad) [cite: 283]
        async function claimReward() {
            if (dailyWatchedAdsCount >= DAILY_AD_LIMIT) { // [cite: 283]
                showAdNotification(translations[currentLanguage].daily_limit_reached); // [cite: 284]
                return; // [cite: 284]
            }

            showAdNotification(translations[currentLanguage].ad_loading); // [cite: 284]
            claimRewardBtn.disabled = true; // Disable button while ad loads [cite: 285]
            
            try {
                if (typeof window.AdexiumWidget !== 'undefined' && adexiumWidget) {
                    // Show Adexium Widget interstitial ad
                    adexiumWidget.showInterstitial(); // Call Adexium's show method
                    
                    // Since Adexium Widget's showInterstitial() doesn't return a promise or have a direct callback for ad completion,
                    // we might need to rely on a timer or a global event listener if Adexium provides one.
                    // For now, we'll assume the ad shows and proceeds after a short delay for simplicity.
                    // In a real application, you'd integrate with Adexium's actual ad completion events.
                    setTimeout(() => { // Simulate ad completion
                        watchedAdsCount++; // [cite: 286]
                        earnedPoints += POINTS_PER_AD; // [cite: 286]
                        dailyWatchedAdsCount++; // [cite: 286]

                        // Update last watched date to today [cite: 287]
                        localStorage.setItem('lastWatchDate', getTodayDate()); // [cite: 287]
                        localStorage.setItem('dailyWatchedAdsCount', dailyWatchedAdsCount); // [cite: 287]
                        
                        if (watchedAdsCount % ADS_FOR_BONUS === 0) { // [cite: 288]
                            earnedPoints += 1.00; // Bonus point [cite: 288]
                        }
                        
                        localStorage.setItem('watchedAdsCount', watchedAdsCount); // [cite: 289]
                        localStorage.setItem('earnedPoints', earnedPoints); // [cite: 289]
                        
                        updateUI(); // [cite: 289]
                        showAdNotification(translations[currentLanguage].ad_completed_success); // [cite: 289]
                        
                        // Reset taps after successful claim [cite: 290]
                        tapsCount = 0; // [cite: 290]
                        updateTapUI(); // [cite: 290]
                        claimRewardBtn.disabled = false; // Re-enable button after simulated completion
                    }, 3000); // Simulate 3 seconds for ad
                } else {
                    console.error("Adexium Widget SDK is not loaded or initialized.");
                    showAdNotification(translations[currentLanguage].ad_failed); // [cite: 292]
                    claimRewardBtn.disabled = false; // Re-enable button
                }

            } catch (error) {
                console.error("Adexium Widget ad error or no ad to show:", error); // [cite: 292]
                showAdNotification(translations[currentLanguage].ad_failed); // [cite: 292]
                claimRewardBtn.disabled = false; // Re-enable button [cite: 293]
            }
        }
        
        // Show ad notification
        function showAdNotification(message) {
            adNotificationEl.textContent = message; // [cite: 294]
            adNotificationEl.style.display = 'block'; // [cite: 294]
            
            setTimeout(() => { // [cite: 294]
                adNotificationEl.style.display = 'none'; // [cite: 295]
            }, 3000); // [cite: 295]
        }

        // Function to show withdraw form
        function showWithdrawForm() {
            withdrawSectionEl.style.display = 'block'; // [cite: 296]
            // Update the current balance when showing the form [cite: 296]
            currentEarnedPointsEl.textContent = earnedPoints.toFixed(2); // [cite: 297]
        }

        // Function to hide withdraw form
        function hideWithdrawForm() {
            withdrawSectionEl.style.display = 'none'; // [cite: 298]
            withdrawStatusEl.textContent = ''; // Clear status message when hiding [cite: 298]
        }

        // Function to handle withdrawal
        function withdrawPoints() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value); // [cite: 299]
            const paymentMethod = document.getElementById('payment-method').value; // [cite: 299]
            const walletAddress = document.getElementById('wallet-address').value; // [cite: 299]

            let minRequiredPoints; // [cite: 300]
            let methodName; // [cite: 300]
            if (paymentMethod === 'faucetpay') { // [cite: 300]
                minRequiredPoints = MIN_WITHDRAW_POINTS_FAUCETPAY; // [cite: 301]
                methodName = translations[currentLanguage].faucetpay_option; // [cite: 301]
            } else { // Covers 'other_wallet' and any default case [cite: 302]
                minRequiredPoints = MIN_WITHDRAW_POINTS; // [cite: 302]
                methodName = translations[currentLanguage].other_wallet_option; // [cite: 302]
            }

            if (isNaN(amount) || amount < minRequiredPoints) { // [cite: 302]
                // Use dynamic message for minimum withdrawal [cite: 303]
                let message = translations[currentLanguage].min_withdraw_message
                    .replace('{methodName}', methodName)
                    .replace('{minAmount}', minRequiredPoints); // [cite: 303]
                showTemporaryMessage(message, 'red'); // [cite: 303]
                return; // [cite: 303]
            }

            if (amount > earnedPoints) { // [cite: 304]
                let message = translations[currentLanguage].insufficient_balance.replace('{earnedPoints}', earnedPoints.toFixed(2)); // [cite: 304]
                showTemporaryMessage(message, 'red'); // [cite: 304]
                return; // [cite: 304]
            }

            if (!walletAddress.trim()) { // [cite: 305]
                showTemporaryMessage(translations[currentLanguage].enter_wallet_address, 'red'); // [cite: 305]
                return; // [cite: 305]
            }

            earnedPoints -= amount; // [cite: 305]
            localStorage.setItem('earnedPoints', earnedPoints.toFixed(2)); // [cite: 306]
            updateUI(); // Update main UI after withdrawal [cite: 306]
            currentEarnedPointsEl.textContent = earnedPoints.toFixed(2); // Update balance on withdrawal form [cite: 307]

            // Construct Telegram message based on selected payment method [cite: 307]
            let messageToAdmin = `New Withdrawal Request:\nUser: ${telegramUserName}\nAmount: ${amount} pepe coins\nPayment Method: `; // [cite: 308]
            if (paymentMethod === 'faucetpay') { // [cite: 308]
                messageToAdmin += `FaucetPay\nWallet Address: ${walletAddress}`; // [cite: 309]
            } else if (paymentMethod === 'other_wallet') { // [cite: 309]
                messageToAdmin += `Other Wallet\nWallet Address: ${walletAddress}`; // [cite: 310]
            } else {
                messageToAdmin += `Unknown Method: ${paymentMethod}\nWallet Address: ${walletAddress}`; // [cite: 311]
            }
            
            sendWithdrawRequestToAdmin(messageToAdmin); // [cite: 312]
            showTemporaryMessage(translations[currentLanguage].withdrawal_success_message, 'green'); // [cite: 312]

            document.getElementById('withdraw-amount').value = ''; // [cite: 312]
            document.getElementById('wallet-address').value = ''; // [cite: 312]
        }

        // Function to send withdrawal request to admin via Telegram
        function sendWithdrawRequestToAdmin(message) {
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${ADMIN_USER_ID}&text=${encodeURIComponent(message)}`)
                .then(response => response.json()) // [cite: 313]
                .then(data => { // [cite: 313]
                    if (data.ok) { // [cite: 313]
                        console.log('Message sent to admin'); // [cite: 313]
                    } else {
                        console.error('Failed to send message to Telegram:', data.description || data); // [cite: 314]
                        let errorMessage = translations[currentLanguage].telegram_send_fail.replace('{error}', data.description || data); // [cite: 314]
                        showTemporaryMessage(errorMessage, 'red'); // [cite: 315]
                    }
                })
                .catch(error => { // [cite: 315]
                    console.error('Error during fetch to Telegram API:', error); // [cite: 315]
                    let errorMessage = translations[currentLanguage].telegram_connect_error.replace('{error}', error.message); // [cite: 316]
                    showTemporaryMessage(errorMessage, 'red'); // [cite: 316]
                });
        }

        // Utility for showing temporary messages
        let messageTimeout; // [cite: 317]
        function showTemporaryMessage(msg, color) {
            withdrawStatusEl.textContent = msg; // [cite: 318]
            withdrawStatusEl.style.color = color; // [cite: 318]
            clearTimeout(messageTimeout); // [cite: 318]
            messageTimeout = setTimeout(() => { // [cite: 318]
                withdrawStatusEl.textContent = ''; // [cite: 319]
            }, 5000); // [cite: 319]
        }

        // Initialize app on load
        window.onload = initApp; // [cite: 320]
    </script>
</body>
                      </html>
